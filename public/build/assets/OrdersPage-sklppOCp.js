import{i as D,r as d,j as e,L as A,z as o,o as c}from"./index-C-fHFgbm.js";import{u as z}from"./useQuery-BCRd2gHe.js";import{u as p}from"./useMutation-GN6p-b8W.js";import{S as v}from"./StatusBadge-Cgj_FQJZ.js";import{M as H}from"./Modal-DzC3nSjg.js";import{P as L}from"./POSInvoice-CEfJoeZS.js";import{q as _,i as w,z as Q,k as O,A as P,o as q}from"./index-CmYeZnUY.js";import"./iconBase-b9VFOml0.js";const S=["placed","confirmed","preparing","ready","served","completed","cancelled"],C={cash:{label:"Cash",icon:O},card:{label:"Card",icon:w},mobile_banking:{label:"mBanking",icon:Q},online:{label:"Online",icon:w}},k=({status:l})=>{const i={paid:"bg-green-100 text-green-700",pending:"bg-amber-100 text-amber-700",failed:"bg-red-100 text-red-700",refunded:"bg-purple-100 text-purple-700"};return e.jsxs("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${i[l]||"bg-gray-100 text-gray-600"}`,children:[l==="paid"&&e.jsx(P,{className:"w-3 h-3 mr-1"}),(l||"N/A").toUpperCase()]})};function X(){var N;const l=D(),[i,u]=d.useState(""),[s,r]=d.useState(null),[h,g]=d.useState(null),[j,b]=d.useState(!1),{data:x,isLoading:T}=z({queryKey:["orders",i],queryFn:()=>c.list({status:i||void 0,today:i?void 0:!0}).then(t=>t.data),refetchInterval:1e4}),F=p({mutationFn:({id:t,status:a})=>c.updateStatus(t,a),onSuccess:()=>{l.invalidateQueries(["orders"]),o.success("Status updated")}}),M=p({mutationFn:t=>c.cancel(t),onSuccess:()=>{l.invalidateQueries(["orders"]),r(null),o.success("Order cancelled")}}),m=p({mutationFn:t=>c.markPaid(t),onSuccess:t=>{var n;l.invalidateQueries(["orders"]);const a=(n=t.data)==null?void 0:n.data;a&&r(a),o.success("Payment marked as paid")}}),I=async t=>{var a;b(!0);try{const n=await c.invoice(t);g(((a=n.data)==null?void 0:a.data)||n.data)}catch{o.error("Failed to load invoice")}finally{b(!1)}};if(T)return e.jsx(A,{});const y=(x==null?void 0:x.data)||[];return e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Orders"}),e.jsxs("div",{className:"flex gap-2 mb-6 overflow-x-auto pb-2",children:[e.jsx("button",{onClick:()=>u(""),className:`px-3 py-1.5 rounded-full text-sm font-medium whitespace-nowrap ${i?"bg-gray-100 text-gray-600":"bg-blue-600 text-white"}`,children:"Today"}),S.map(t=>e.jsx("button",{onClick:()=>u(t),className:`px-3 py-1.5 rounded-full text-sm font-medium capitalize whitespace-nowrap ${i===t?"bg-blue-600 text-white":"bg-gray-100 text-gray-600"}`,children:t},t))]}),e.jsxs("div",{className:"space-y-3",children:[y.map(t=>{var a,n;return e.jsx("div",{className:"card cursor-pointer hover:shadow-md",onClick:()=>r(t),children:e.jsxs("div",{className:"flex items-start sm:items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-bold",children:t.order_number}),e.jsx(v,{status:t.status}),e.jsx("span",{className:"text-xs text-gray-400 capitalize",children:t.type==="quick"?"Quick Sale":t.type}),t.source==="pos"&&e.jsxs("span",{className:"inline-flex items-center gap-0.5 px-1.5 py-0.5 rounded text-[10px] font-semibold bg-indigo-100 text-indigo-700",children:[e.jsx(_,{className:"w-3 h-3"})," POS"]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 flex-wrap",children:[e.jsxs("p",{className:"text-sm text-gray-500 truncate",children:[(a=t.table)!=null&&a.table_number?`Table ${t.table.table_number}`:t.customer_name||"Walk-in"," · ",((n=t.items)==null?void 0:n.length)||0," items"]}),t.payment_method&&(()=>{const f=C[t.payment_method]||{label:t.payment_method,icon:O};return e.jsxs("span",{className:"inline-flex items-center text-xs text-gray-400",children:[e.jsx(f.icon,{className:"w-3.5 h-3.5 mr-0.5"}),f.label]})})(),t.payment_status&&e.jsx(k,{status:t.payment_status})]})]}),e.jsxs("div",{className:"text-right shrink-0",children:[e.jsxs("p",{className:"font-bold text-lg",children:["৳",t.grand_total]}),e.jsx("p",{className:"text-xs text-gray-400",children:new Date(t.created_at).toLocaleTimeString()})]})]})},t.id)}),y.length===0&&e.jsx("p",{className:"text-center text-gray-400 py-8",children:"No orders found"})]}),e.jsx(H,{isOpen:!!s,onClose:()=>r(null),title:`Order ${s==null?void 0:s.order_number}`,size:"lg",children:s&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsx(v,{status:s.status}),e.jsx("span",{className:"capitalize text-sm",children:s.type}),s.table&&e.jsxs("span",{className:"text-sm",children:["Table: ",s.table.table_number]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 flex items-center justify-between flex-wrap gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center gap-1.5 text-sm",children:(()=>{const t=C[s.payment_method];return t?e.jsxs(e.Fragment,{children:[e.jsx(t.icon,{className:"w-5 h-5 text-blue-600"})," ",e.jsxs("span",{children:[t.label,s.payment_gateway?` (${s.payment_gateway})`:""]})]}):e.jsx("span",{className:"text-gray-400",children:"No payment method"})})()}),e.jsx(k,{status:s.payment_status}),s.source==="pos"&&e.jsxs("span",{className:"inline-flex items-center gap-0.5 px-1.5 py-0.5 rounded text-[10px] font-semibold bg-indigo-100 text-indigo-700",children:[e.jsx(_,{className:"w-3 h-3"})," POS"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.payment_status!=="paid"&&e.jsxs("button",{onClick:()=>m.mutate(s.id),disabled:m.isPending,className:"inline-flex items-center gap-1 px-3 py-1.5 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 disabled:opacity-50",children:[e.jsx(P,{className:"w-4 h-4"}),m.isPending?"Saving...":"Mark Paid"]}),e.jsxs("button",{onClick:()=>I(s.order_number),disabled:j,className:"inline-flex items-center gap-1 px-3 py-1.5 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 disabled:opacity-50",children:[e.jsx(q,{className:"w-4 h-4"}),j?"Loading...":"Invoice"]})]})]}),s.paid_at&&e.jsxs("p",{className:"text-xs text-green-600",children:["Paid at: ",new Date(s.paid_at).toLocaleString()]}),s.transaction_id&&e.jsxs("p",{className:"text-xs text-gray-500",children:["TXN: ",s.transaction_id]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-2",children:"Item"}),e.jsx("th",{className:"text-center px-4 py-2",children:"Qty"}),e.jsx("th",{className:"text-right px-4 py-2",children:"Price"}),e.jsx("th",{className:"text-right px-4 py-2",children:"Total"})]})}),e.jsx("tbody",{children:(N=s.items)==null?void 0:N.map(t=>{var a;return e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-2",children:(a=t.menu_item)==null?void 0:a.name}),e.jsx("td",{className:"text-center px-4 py-2",children:t.qty}),e.jsxs("td",{className:"text-right px-4 py-2",children:["৳",t.price_at_sale]}),e.jsxs("td",{className:"text-right px-4 py-2",children:["৳",t.line_total]})]},t.id)})})]})}),e.jsxs("div",{className:"text-right space-y-1",children:[e.jsxs("p",{children:["Subtotal: ৳",s.subtotal]}),parseFloat(s.discount)>0&&e.jsxs("p",{className:"text-green-600",children:["Discount: -৳",s.discount]}),parseFloat(s.net_amount)>0&&parseFloat(s.net_amount)!==parseFloat(s.subtotal)-parseFloat(s.discount)&&e.jsxs("p",{children:["Net Amount: ৳",s.net_amount]}),parseFloat(s.vat_amount||s.tax||0)>0&&e.jsxs("p",{children:["VAT (",s.vat_rate??0,"%): ৳",s.vat_amount||s.tax]}),e.jsxs("p",{className:"text-xl font-bold",children:["Total: ৳",s.grand_total]})]}),!["completed","cancelled"].includes(s.status)&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 pt-4 border-t",children:[e.jsx("select",{className:"input sm:max-w-xs",value:s.status,onChange:t=>F.mutate({id:s.id,status:t.target.value}),children:S.map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx("button",{onClick:()=>M.mutate(s.id),className:"btn-danger",children:"Cancel"})]})]})}),h&&e.jsx(L,{data:h,onClose:()=>g(null)})]})}export{X as default};
