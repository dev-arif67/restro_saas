import{i as y,r as x,j as e,L as N,z as n,v as c}from"./index-BR0FwfB_.js";import{u as v}from"./useQuery-CFHvZ_7i.js";import{u as p}from"./useMutation-BJ14fqOg.js";import{M as _}from"./Modal-B-DA64xN.js";function S(){var o;const u=y(),[h,l]=x.useState(!1),[a,r]=x.useState(null),{data:i,isLoading:j}=v({queryKey:["vouchers"],queryFn:()=>c.list().then(s=>s.data.data)}),d=p({mutationFn:s=>a?c.update(a.id,s):c.create(s),onSuccess:()=>{u.invalidateQueries(["vouchers"]),l(!1),r(null),n.success(a?"Updated":"Created")},onError:s=>{var t,m;return n.error(((m=(t=s.response)==null?void 0:t.data)==null?void 0:m.message)||"Error")}}),b=p({mutationFn:s=>c.delete(s),onSuccess:()=>{u.invalidateQueries(["vouchers"]),n.success("Deleted")}}),f=s=>{s.preventDefault();const t=Object.fromEntries(new FormData(s.target));t.is_active=s.target.is_active.checked,t.discount_value=parseFloat(t.discount_value),t.min_purchase=parseFloat(t.min_purchase||0),t.max_uses&&(t.max_uses=parseInt(t.max_uses)),d.mutate(t)};return j?e.jsx(N,{}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-800",children:"Vouchers"}),e.jsx("button",{onClick:()=>{r(null),l(!0)},className:"btn-primary text-sm sm:text-base",children:"+ Add Voucher"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:i==null?void 0:i.map(s=>e.jsxs("div",{className:`card ${s.is_active?"":"opacity-60"}`,children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("code",{className:"text-lg font-bold text-blue-600",children:s.code}),e.jsx("span",{className:`text-xs font-medium px-2 py-1 rounded ${s.is_active?"bg-green-100 text-green-700":"bg-gray-100 text-gray-500"}`,children:s.is_active?"Active":"Inactive"})]}),e.jsx("p",{className:"text-2xl font-bold mt-2",children:s.type==="percentage"?`${s.discount_value}%`:`৳${s.discount_value}`}),e.jsxs("div",{className:"text-sm text-gray-500 mt-2 space-y-1",children:[e.jsxs("p",{children:["Min purchase: ৳",s.min_purchase]}),e.jsxs("p",{children:["Expires: ",new Date(s.expiry_date).toLocaleDateString()]}),s.max_uses&&e.jsxs("p",{children:["Uses: ",s.used_count,"/",s.max_uses]})]}),e.jsxs("div",{className:"flex gap-3 mt-4 pt-3 border-t",children:[e.jsx("button",{onClick:()=>{r(s),l(!0)},className:"text-sm text-blue-600",children:"Edit"}),e.jsx("button",{onClick:()=>{confirm("Delete?")&&b.mutate(s.id)},className:"text-sm text-red-600",children:"Delete"})]})]},s.id))}),e.jsx(_,{isOpen:h,onClose:()=>l(!1),title:a?"Edit Voucher":"Add Voucher",children:e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Code"}),e.jsx("input",{name:"code",className:"input uppercase",defaultValue:a==null?void 0:a.code,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Type"}),e.jsxs("select",{name:"type",className:"input",defaultValue:(a==null?void 0:a.type)||"fixed",children:[e.jsx("option",{value:"fixed",children:"Fixed (৳)"}),e.jsx("option",{value:"percentage",children:"Percentage (%)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Discount Value"}),e.jsx("input",{name:"discount_value",type:"number",step:"0.01",className:"input",defaultValue:a==null?void 0:a.discount_value,required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Min Purchase"}),e.jsx("input",{name:"min_purchase",type:"number",className:"input",defaultValue:(a==null?void 0:a.min_purchase)||0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Max Uses"}),e.jsx("input",{name:"max_uses",type:"number",className:"input",defaultValue:a==null?void 0:a.max_uses,placeholder:"Unlimited"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Expiry Date"}),e.jsx("input",{name:"expiry_date",type:"date",className:"input",defaultValue:(o=a==null?void 0:a.expiry_date)==null?void 0:o.split("T")[0],required:!0})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{name:"is_active",type:"checkbox",defaultChecked:(a==null?void 0:a.is_active)??!0,className:"rounded"}),e.jsx("label",{className:"text-sm",children:"Active"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",className:"btn-primary",disabled:d.isPending,children:"Save"}),e.jsx("button",{type:"button",onClick:()=>l(!1),className:"btn-secondary",children:"Cancel"})]})]})})]})}export{S as default};
