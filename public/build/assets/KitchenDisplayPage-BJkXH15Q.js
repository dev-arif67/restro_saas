import{i as f,r as l,j as e,L as y,z as p,y as i}from"./index-DOj4cv-Y.js";import{u as g}from"./useQuery-v6eG86EQ.js";import{u as b}from"./useMutation-CzbCp_v3.js";import{S as j}from"./StatusBadge-BDL9JjHF.js";const A={placed:"border-red-400 bg-red-50",confirmed:"border-orange-400 bg-orange-50",preparing:"border-yellow-400 bg-yellow-50",ready:"border-green-400 bg-green-50"};function R(){const c=f(),d=l.useRef(null),{data:t,isLoading:h}=g({queryKey:["kitchen-orders"],queryFn:()=>i.activeOrders().then(s=>s.data.data),refetchInterval:5e3}),{data:a}=g({queryKey:["kitchen-stats"],queryFn:()=>i.stats().then(s=>s.data.data),refetchInterval:1e4}),o=b({mutationFn:s=>i.advanceOrder(s),onSuccess:()=>{c.invalidateQueries(["kitchen-orders"]),c.invalidateQueries(["kitchen-stats"]),p.success("Order advanced")},onError:s=>{var r,n;return p.error(((n=(r=s.response)==null?void 0:r.data)==null?void 0:n.message)||"Error")}}),u=l.useRef(0);if(l.useEffect(()=>{var s;if(t&&t.length>u.current)try{(s=d.current)==null||s.play()}catch{}u.current=(t==null?void 0:t.length)||0},[t==null?void 0:t.length]),h)return e.jsx(y,{fullScreen:!0});const x=t||[];return e.jsxs("div",{className:"min-h-screen bg-gray-900 text-white p-4",children:[e.jsx("audio",{ref:d,preload:"auto",children:e.jsx("source",{src:"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA==",type:"audio/wav"})}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3 mb-6",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold",children:"Kitchen Display"}),e.jsxs("div",{className:"flex gap-2 sm:gap-4 text-xs sm:text-sm flex-wrap",children:[e.jsxs("span",{className:"bg-red-600 px-2 sm:px-3 py-1 rounded-full",children:["Pending: ",(a==null?void 0:a.pending)||0]}),e.jsxs("span",{className:"bg-yellow-600 px-2 sm:px-3 py-1 rounded-full",children:["Preparing: ",(a==null?void 0:a.preparing)||0]}),e.jsxs("span",{className:"bg-green-600 px-2 sm:px-3 py-1 rounded-full",children:["Ready: ",(a==null?void 0:a.ready)||0]}),e.jsxs("span",{className:"bg-blue-600 px-2 sm:px-3 py-1 rounded-full",children:["Today: ",(a==null?void 0:a.total_today)||0]})]})]}),x.length===0?e.jsx("div",{className:"flex items-center justify-center h-[60vh]",children:e.jsx("p",{className:"text-3xl text-gray-500 font-bold",children:"No Active Orders"})}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:x.map(s=>{var r;return e.jsxs("div",{className:`rounded-xl border-2 p-4 ${A[s.status]||"border-gray-600 bg-gray-800"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-lg font-bold text-gray-900",children:s.order_number}),e.jsx(j,{status:s.status})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3 text-sm text-gray-700",children:[e.jsx("span",{className:"capitalize",children:s.type}),s.table&&e.jsxs("span",{children:["· Table ",s.table.table_number]}),e.jsxs("span",{children:["· ",new Date(s.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),e.jsx("div",{className:"space-y-2 mb-4",children:(r=s.items)==null?void 0:r.map(n=>{var m;return e.jsx("div",{className:"flex justify-between items-start text-gray-900",children:e.jsxs("div",{children:[e.jsxs("span",{className:"font-bold text-lg mr-2",children:[n.qty,"x"]}),e.jsx("span",{className:"font-medium",children:(m=n.menu_item)==null?void 0:m.name}),n.special_instructions&&e.jsxs("p",{className:"text-xs text-red-600 mt-0.5",children:["Note: ",n.special_instructions]})]})},n.id)})}),!["completed","cancelled","served"].includes(s.status)&&e.jsxs("button",{onClick:()=>o.mutate(s.id),disabled:o.isPending,className:"w-full py-3 rounded-lg font-bold text-white bg-blue-600 hover:bg-blue-700 transition",children:[s.status==="placed"&&"Confirm",s.status==="confirmed"&&"Start Preparing",s.status==="preparing"&&"Mark Ready",s.status==="ready"&&"Mark Served"]})]},s.id)})})]})}export{R as default};
