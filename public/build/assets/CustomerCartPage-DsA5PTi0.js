import{d as K,b as Q,e as G,A as W,r as o,j as e,f as D,g as J,z as b}from"./index-DOj4cv-Y.js";import{u as X}from"./useMutation-CzbCp_v3.js";import{u as Z}from"./cartStore-bhPDNTa8.js";import{L as ee,F as te,c as se,M as ae,N as re,u as le,k as oe,i as ne}from"./index-BdfqSiwZ.js";import"./iconBase-um1MA9Tc.js";function ce(a,h){try{const p=`recent_orders_${a}`,d=JSON.parse(localStorage.getItem(p)||"[]"),u=[{orderNumber:h,placedAt:new Date().toISOString()},...d.filter(g=>g.orderNumber!==h)].slice(0,10);localStorage.setItem(p,JSON.stringify(u));const j="recent_orders",N=JSON.parse(localStorage.getItem(j)||"[]"),w=[{orderNumber:h,slug:a,placedAt:new Date().toISOString()},...N.filter(g=>g.orderNumber!==h)].slice(0,20);localStorage.setItem(j,JSON.stringify(w))}catch{}}function be(){const{slug:a}=K(),h=Q(),[p]=G(),{restaurant:d,tableId:y}=W()||{},{items:u,removeItem:j,updateQty:N,clearCart:_,getSubtotal:w,getOrderPayload:g,setNotes:z}=Z(),r=(d==null?void 0:d.primary_color)||"#3B82F6",[v,P]=o.useState(""),[s,C]=o.useState(null),[$,I]=o.useState(!1),[i,F]=o.useState(y?"dine":"parcel"),[l,A]=o.useState("cash"),[m,E]=o.useState(""),[x,H]=o.useState(""),[L,B]=o.useState(""),[M,U]=o.useState(!1);o.useEffect(()=>{try{const t=JSON.parse(localStorage.getItem(`customer_info_${a}`)||"{}");t.name&&E(t.name),t.phone&&H(t.phone)}catch{}},[a]);const f=w(),S=s?s.type==="percentage"?f*(s.discount_value/100):Math.min(s.discount_value,f):0,V=(d==null?void 0:d.tax_rate)||0,R=Math.max(f-S,0),k=R*(V/100),T=R+k,q=async()=>{var t,n;if(v.trim()){I(!0);try{const{data:c}=await J.validateVoucher(a,v,f);C(c.data.voucher),b.success("Voucher applied!")}catch(c){C(null),b.error(((n=(t=c.response)==null?void 0:t.data)==null?void 0:n.message)||"Invalid voucher")}finally{I(!1)}}},O=X({mutationFn:t=>J.placeOrder(a,t),onSuccess:t=>{const n=t.data.data,c=n.order_number;if(m||x)try{localStorage.setItem(`customer_info_${a}`,JSON.stringify({name:m,phone:x}))}catch{}if(ce(a,c),_(),l==="online"&&n.payment_url){U(!0),b.success("Redirecting to payment..."),window.location.href=n.payment_url;return}b.success("Order placed!"),h(`/order/${c}`)},onError:t=>{var n,c;return b.error(((c=(n=t.response)==null?void 0:n.data)==null?void 0:c.message)||"Order failed")}}),Y=()=>{if(u.length===0)return b.error("Cart is empty");if(i==="parcel"&&(!m||!x))return b.error("Name and phone required for takeaway");const t={...g(),type:i,tenant_slug:a,table_id:y||null,voucher_code:(s==null?void 0:s.code)||void 0,customer_name:m||void 0,customer_phone:x||void 0,payment_method:l,notes:L||void 0};O.mutate(t)};return e.jsxs("div",{className:"pb-32 px-3",children:[e.jsxs("div",{className:"flex items-center gap-3 py-4",children:[e.jsx(D,{to:`/restaurant/${a}?${p.toString()}`,className:"w-9 h-9 rounded-full bg-gray-100 flex items-center justify-center hover:bg-gray-200 transition",children:e.jsx(ee,{className:"w-5 h-5 text-gray-600"})}),e.jsxs("h2",{className:"text-lg font-bold text-gray-900",children:["Your Cart (",u.length,")"]})]}),u.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(te,{className:"w-16 h-16 text-gray-200 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 text-lg font-medium",children:"Your cart is empty"}),e.jsx(D,{to:`/restaurant/${a}?${p.toString()}`,className:"inline-block mt-3 px-6 py-2.5 rounded-full text-white text-sm font-medium",style:{backgroundColor:r},children:"Browse Menu"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2.5 mb-5",children:u.map(t=>e.jsxs("div",{className:"bg-white rounded-2xl p-3.5 shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-sm truncate",children:t.name}),e.jsxs("p",{className:"text-xs font-bold mt-0.5",style:{color:r},children:["à§³",parseFloat(t.price).toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>N(t.menu_item_id,t.qty-1),className:"w-7 h-7 rounded-full bg-gray-100 text-gray-600 flex items-center justify-center text-sm font-bold active:bg-red-100 active:text-red-600 transition",children:"âˆ’"}),e.jsx("span",{className:"w-6 text-center font-bold text-sm",children:t.qty}),e.jsx("button",{onClick:()=>N(t.menu_item_id,t.qty+1),className:"w-7 h-7 rounded-full text-white flex items-center justify-center text-sm font-bold active:scale-90 transition",style:{backgroundColor:r},children:"+"})]}),e.jsxs("p",{className:"text-sm font-bold text-gray-900 w-14 text-right",children:["à§³",(t.price*t.qty).toFixed(0)]})]}),e.jsx("div",{className:"flex justify-end mt-1",children:e.jsx("button",{onClick:()=>j(t.menu_item_id),className:"text-xs text-red-400 hover:text-red-600 transition",children:"Remove"})})]},t.menu_item_id))}),e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-gray-100 mb-3",children:[e.jsx("label",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2.5 block",children:"Order Type"}),e.jsxs("div",{className:"flex gap-2",children:[y&&e.jsx("button",{onClick:()=>F("dine"),className:"flex-1 py-2.5 rounded-xl text-sm font-medium transition-all",style:i==="dine"?{backgroundColor:r,color:"#fff"}:{backgroundColor:"#f3f4f6",color:"#6b7280"},children:"ðŸ½ï¸ Dine-in"}),e.jsx("button",{onClick:()=>F("parcel"),className:"flex-1 py-2.5 rounded-xl text-sm font-medium transition-all",style:i==="parcel"?{backgroundColor:r,color:"#fff"}:{backgroundColor:"#f3f4f6",color:"#6b7280"},children:"ðŸ“¦ Takeaway"})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-gray-100 mb-3 space-y-3",children:[e.jsxs("label",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide block",children:["Customer Info ",i==="dine"&&e.jsx("span",{className:"text-gray-400 normal-case",children:"(optional)"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{className:"w-full pl-9 pr-3 py-2.5 rounded-xl border border-gray-200 text-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none",placeholder:i==="parcel"?"Name *":"Name",value:m,onChange:t=>E(t.target.value)})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{className:"w-full pl-9 pr-3 py-2.5 rounded-xl border border-gray-200 text-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none",placeholder:i==="parcel"?"Phone *":"Phone",value:x,onChange:t=>H(t.target.value)})]})]})]}),e.jsx("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-gray-100 mb-3",children:e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-3 text-gray-400 w-4 h-4"}),e.jsx("textarea",{className:"w-full pl-9 pr-3 py-2.5 rounded-xl border border-gray-200 text-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none resize-none",placeholder:"Special instructions or notes...",rows:2,value:L,onChange:t=>{B(t.target.value),z(t.target.value)}})]})}),e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-gray-100 mb-3",children:[e.jsx("label",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2.5 block",children:"Voucher Code"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(le,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{className:"w-full pl-9 pr-3 py-2.5 rounded-xl border border-gray-200 text-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none disabled:bg-gray-50",placeholder:"Enter code",value:v,onChange:t=>P(t.target.value.toUpperCase()),disabled:!!s,onKeyDown:t=>t.key==="Enter"&&q()})]}),s?e.jsx("button",{onClick:()=>{C(null),P("")},className:"px-4 py-2.5 text-xs text-red-600 border border-red-200 rounded-xl hover:bg-red-50 font-medium",children:"Remove"}):e.jsx("button",{onClick:q,className:"px-5 py-2.5 rounded-xl text-white text-sm font-medium disabled:opacity-40 transition",style:{backgroundColor:"#1f2937"},disabled:!v.trim()||$,children:$?"...":"Apply"})]}),s&&e.jsxs("div",{className:"mt-2 flex items-center gap-1.5 text-green-600",children:[e.jsx("span",{className:"text-sm",children:"âœ“"}),e.jsxs("p",{className:"text-sm font-medium",children:[s.type==="percentage"?`${s.discount_value}% off`:`à§³${s.discount_value} off`," applied!"]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-gray-100 mb-3",children:[e.jsx("label",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-3 block",children:"Payment Method"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>A("cash"),className:`flex flex-col items-center gap-1.5 p-4 rounded-2xl border-2 transition-all ${l==="cash"?"border-blue-600 bg-blue-50":"border-gray-200 bg-white hover:border-gray-300"}`,children:[e.jsx(oe,{className:"w-7 h-7",style:{color:l==="cash"?r:"#6b7280"}}),e.jsx("span",{className:"text-sm font-medium",style:{color:l==="cash"?r:"#6b7280"},children:"Pay at Counter"}),e.jsx("span",{className:"text-xs text-gray-400",children:"Cash / Card"})]}),e.jsxs("button",{onClick:()=>A("online"),className:`flex flex-col items-center gap-1.5 p-4 rounded-2xl border-2 transition-all ${l==="online"?"border-blue-600 bg-blue-50":"border-gray-200 bg-white hover:border-gray-300"}`,children:[e.jsx(ne,{className:"w-7 h-7",style:{color:l==="online"?r:"#6b7280"}}),e.jsx("span",{className:"text-sm font-medium",style:{color:l==="online"?r:"#6b7280"},children:"Pay Online"}),e.jsx("span",{className:"text-xs text-gray-400",children:"SSLCommerz"})]})]}),l==="online"&&e.jsx("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-xl",children:e.jsx("p",{className:"text-xs text-blue-700",children:"You will be redirected to SSLCommerz secure payment gateway after placing the order."})})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-gray-100 mb-3 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Subtotal"}),e.jsxs("span",{className:"font-medium",children:["à§³",f.toFixed(2)]})]}),S>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"Voucher Discount"}),e.jsxs("span",{className:"font-medium",children:["-à§³",S.toFixed(2)]})]}),k>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-500",children:["Tax (",V,"%)"]}),e.jsxs("span",{className:"font-medium",children:["à§³",k.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold pt-2 border-t border-gray-100",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{style:{color:r},children:["à§³",T.toFixed(2)]})]})]}),i==="parcel"&&(!(m!=null&&m.trim())||!(x!=null&&x.trim()))&&e.jsx("p",{className:"text-xs text-center text-amber-600 mb-2 bg-amber-50 rounded-xl py-2",children:"Customer name & phone required for takeaway orders"})]}),u.length>0&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-3 bg-white border-t border-gray-100 max-w-lg mx-auto safe-area-bottom",children:e.jsx("button",{onClick:Y,disabled:O.isPending||M,className:"w-full py-3.5 text-white rounded-2xl text-sm font-bold transition-all active:scale-[0.98] disabled:opacity-50 shadow-lg",style:{backgroundColor:r},children:M?"Redirecting to payment...":O.isPending?"Placing order...":`${l==="online"?"Place Order & Pay":"Place Order"} â€” à§³${T.toFixed(2)}`})})]})}export{be as default};
