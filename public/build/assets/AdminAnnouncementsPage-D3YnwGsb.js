import{i as P,r as d,j as e,L as q,z as c,C as r}from"./index-C-fHFgbm.js";import{u as A}from"./useQuery-BCRd2gHe.js";import{u as m}from"./useMutation-GN6p-b8W.js";import{M as C}from"./Modal-DzC3nSjg.js";import{S as L}from"./StatusBadge-Cgj_FQJZ.js";import{l as Q,U as H,T as R,V,C as z}from"./index-CmYeZnUY.js";import"./iconBase-b9VFOml0.js";function W(){var w;const o=P(),[T,h]=d.useState(!1),[E,N]=d.useState(!1),[p,b]=d.useState(null),[i,M]=d.useState(null),[a,l]=d.useState({title:"",body:"",type:"in_app",recipients_type:"all",specific_tenant_ids:[]}),{data:x,isLoading:F}=A({queryKey:["admin-announcements"],queryFn:()=>r.announcements.list().then(s=>s.data.data)}),{data:y}=A({queryKey:["admin-tenants-list"],queryFn:()=>r.tenants.list({per_page:100}).then(s=>s.data.data)}),g=m({mutationFn:s=>r.announcements.create(s),onSuccess:()=>{o.invalidateQueries(["admin-announcements"]),u(),c.success("Announcement created")},onError:s=>{var t,n;return c.error(((n=(t=s.response)==null?void 0:t.data)==null?void 0:n.message)||"Failed to create")}}),j=m({mutationFn:({id:s,data:t})=>r.announcements.update(s,t),onSuccess:()=>{o.invalidateQueries(["admin-announcements"]),u(),c.success("Announcement updated")},onError:s=>{var t,n;return c.error(((n=(t=s.response)==null?void 0:t.data)==null?void 0:n.message)||"Failed to update")}}),k=m({mutationFn:s=>r.announcements.delete(s),onSuccess:()=>{o.invalidateQueries(["admin-announcements"]),c.success("Announcement deleted")},onError:s=>{var t,n;return c.error(((n=(t=s.response)==null?void 0:t.data)==null?void 0:n.message)||"Failed to delete")}}),v=m({mutationFn:s=>r.announcements.send(s),onSuccess:s=>{o.invalidateQueries(["admin-announcements"]);const t=s.data.data;c.success(`Sent to ${t.recipients_count} tenants${t.emails_sent?`, ${t.emails_sent} emails sent`:""}`)},onError:s=>{var t,n;return c.error(((n=(t=s.response)==null?void 0:t.data)==null?void 0:n.message)||"Failed to send")}}),u=()=>{h(!1),b(null),l({title:"",body:"",type:"in_app",recipients_type:"all",specific_tenant_ids:[]})},D=s=>{b(s),l({title:s.title,body:s.body,type:s.type,recipients_type:s.recipients_type,specific_tenant_ids:s.specific_tenant_ids||[]}),h(!0)},O=s=>{s.preventDefault(),p?j.mutate({id:p.id,data:a}):g.mutate(a)},f=s=>{switch(s){case"in_app":return"In-App";case"email":return"Email";case"both":return"Both";default:return s}},_=s=>{switch(s){case"all":return"All Tenants";case"active":return"Active Tenants";case"expiring":return"Expiring Soon";case"specific":return"Specific Tenants";default:return s}};if(F)return e.jsx(q,{});const S=(x==null?void 0:x.data)||x||[];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Announcements"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Send notifications to your tenants"})]}),e.jsx("button",{onClick:()=>h(!0),className:"btn-primary",children:"+ New Announcement"})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{className:"text-left",children:[e.jsx("th",{className:"px-4 py-3 font-medium text-gray-600",children:"Title"}),e.jsx("th",{className:"px-4 py-3 font-medium text-gray-600",children:"Type"}),e.jsx("th",{className:"px-4 py-3 font-medium text-gray-600",children:"Recipients"}),e.jsx("th",{className:"px-4 py-3 font-medium text-gray-600",children:"Status"}),e.jsx("th",{className:"px-4 py-3 font-medium text-gray-600",children:"Created"}),e.jsx("th",{className:"px-4 py-3"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[S.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"font-medium text-gray-900",children:s.title})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"px-2 py-1 bg-blue-50 text-blue-700 rounded-full text-xs",children:f(s.type)})}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:_(s.recipients_type)}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(L,{status:s.status==="sent"?"active":"pending",children:s.status})}),e.jsx("td",{className:"px-4 py-3 text-gray-500",children:new Date(s.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{M(s),N(!0)},className:"p-1 hover:bg-gray-100 rounded text-gray-500",title:"View",children:e.jsx(H,{className:"w-4 h-4"})}),s.status==="draft"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>D(s),className:"p-1 hover:bg-gray-100 rounded text-gray-500",title:"Edit",children:e.jsx(R,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>v.mutate(s.id),disabled:v.isPending,className:"p-1 hover:bg-green-100 rounded text-green-600",title:"Send Now",children:e.jsx(V,{className:"w-4 h-4"})})]}),e.jsx("button",{onClick:()=>{confirm("Delete this announcement?")&&k.mutate(s.id)},className:"p-1 hover:bg-red-100 rounded text-red-500",title:"Delete",children:e.jsx(z,{className:"w-4 h-4"})})]})})]},s.id)),S.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-8 text-center text-gray-400",children:"No announcements yet"})})]})]})}),e.jsx(C,{isOpen:T,onClose:u,title:p?"Edit Announcement":"New Announcement",size:"lg",children:e.jsxs("form",{onSubmit:O,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Title"}),e.jsx("input",{type:"text",className:"input",value:a.title,onChange:s=>l({...a,title:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Message"}),e.jsx("textarea",{className:"input min-h-[150px]",value:a.body,onChange:s=>l({...a,body:s.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Type"}),e.jsxs("select",{className:"input",value:a.type,onChange:s=>l({...a,type:s.target.value}),children:[e.jsx("option",{value:"in_app",children:"In-App Only"}),e.jsx("option",{value:"email",children:"Email Only"}),e.jsx("option",{value:"both",children:"Both"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Recipients"}),e.jsxs("select",{className:"input",value:a.recipients_type,onChange:s=>l({...a,recipients_type:s.target.value}),children:[e.jsx("option",{value:"all",children:"All Tenants"}),e.jsx("option",{value:"active",children:"Active Tenants Only"}),e.jsx("option",{value:"expiring",children:"Expiring Soon (30 days)"}),e.jsx("option",{value:"specific",children:"Specific Tenants"})]})]})]}),a.recipients_type==="specific"&&e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Select Tenants"}),e.jsx("div",{className:"max-h-40 overflow-y-auto border rounded-lg p-2 space-y-1",children:y==null?void 0:y.map(s=>e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:a.specific_tenant_ids.includes(s.id),onChange:t=>{t.target.checked?l({...a,specific_tenant_ids:[...a.specific_tenant_ids,s.id]}):l({...a,specific_tenant_ids:a.specific_tenant_ids.filter(n=>n!==s.id)})},className:"w-4 h-4 text-blue-600 rounded"}),e.jsx("span",{className:"text-sm",children:s.name})]},s.id))})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",className:"btn-primary",disabled:g.isPending||j.isPending,children:g.isPending||j.isPending?"Saving...":p?"Update":"Create Draft"}),e.jsx("button",{type:"button",onClick:u,className:"btn-secondary",children:"Cancel"})]})]})}),e.jsx(C,{isOpen:E,onClose:()=>N(!1),title:"Announcement Details",children:i&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500 uppercase",children:"Title"}),e.jsx("p",{className:"font-medium text-gray-900",children:i.title})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500 uppercase",children:"Message"}),e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:i.body})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500 uppercase",children:"Type"}),e.jsx("p",{className:"text-gray-700",children:f(i.type)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500 uppercase",children:"Recipients"}),e.jsx("p",{className:"text-gray-700",children:_(i.recipients_type)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500 uppercase",children:"Status"}),e.jsx("p",{className:"text-gray-700 capitalize",children:i.status})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500 uppercase",children:i.status==="sent"?"Sent At":"Created At"}),e.jsx("p",{className:"text-gray-700",children:new Date(i.sent_at||i.created_at).toLocaleString()})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500 uppercase",children:"Created By"}),e.jsx("p",{className:"text-gray-700",children:((w=i.created_by)==null?void 0:w.name)||"Unknown"})]})]})})]})}export{W as default};
