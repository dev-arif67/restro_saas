import{n as k,r as d,j as e,L as M,z as n,I as u}from"./index-BzAOpcNr.js";import{u as D}from"./useQuery-CZF3df-b.js";import{u as j}from"./useMutation-DsUlt__W.js";import{M as E}from"./Modal-_HOdyNdP.js";import{j as q,T as I,C as A}from"./index-CSl-U68a.js";import"./iconBase-bw2gwbay.js";function L(){const o=k(),[f,m]=d.useState(!1),[l,y]=d.useState(null),[a,i]=d.useState({name:"",slug:"",price:"",duration_days:30,features:[],max_users:5,is_active:!0,sort_order:0}),[x,p]=d.useState(""),{data:g,isLoading:N}=D({queryKey:["admin-plans"],queryFn:()=>u.plans.list().then(s=>s.data.data)}),h=j({mutationFn:s=>u.plans.create(s),onSuccess:()=>{o.invalidateQueries(["admin-plans"]),c(),n.success("Plan created successfully")},onError:s=>{var t,r;return n.error(((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to create plan")}}),b=j({mutationFn:({id:s,data:t})=>u.plans.update(s,t),onSuccess:()=>{o.invalidateQueries(["admin-plans"]),c(),n.success("Plan updated successfully")},onError:s=>{var t,r;return n.error(((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to update plan")}}),_=j({mutationFn:s=>u.plans.delete(s),onSuccess:()=>{o.invalidateQueries(["admin-plans"]),n.success("Plan deleted successfully")},onError:s=>{var t,r;return n.error(((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to delete plan")}}),c=()=>{m(!1),y(null),i({name:"",slug:"",price:"",duration_days:30,features:[],max_users:5,is_active:!0,sort_order:0}),p("")},C=s=>{y(s),i({name:s.name,slug:s.slug,price:s.price,duration_days:s.duration_days,features:s.features||[],max_users:s.max_users,is_active:s.is_active,sort_order:s.sort_order}),m(!0)},P=s=>{s.preventDefault();const t={...a,price:parseFloat(a.price),duration_days:parseInt(a.duration_days),max_users:parseInt(a.max_users),sort_order:parseInt(a.sort_order)};l?b.mutate({id:l.id,data:t}):h.mutate(t)},v=()=>{x.trim()&&(i({...a,features:[...a.features,x.trim()]}),p(""))},w=s=>{i({...a,features:a.features.filter((t,r)=>r!==s)})},F=s=>new Intl.NumberFormat("en-BD",{style:"currency",currency:"BDT",minimumFractionDigits:0}).format(s||0);return N?e.jsx(M,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Subscription Plans"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Manage subscription plans and pricing"})]}),e.jsx("button",{onClick:()=>m(!0),className:"btn-primary",children:"+ Create Plan"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:g==null?void 0:g.map(s=>{var t;return e.jsxs("div",{className:`bg-white rounded-xl p-6 shadow-sm border-2 transition-all ${s.is_active?"border-blue-200":"border-gray-200 opacity-60"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"font-bold text-lg text-gray-900",children:s.name})]}),e.jsx("p",{className:"text-xs text-gray-400 font-mono",children:s.slug})]}),!s.is_active&&e.jsx("span",{className:"text-xs px-2 py-1 bg-gray-100 text-gray-600 rounded-full",children:"Inactive"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:F(s.price)}),e.jsxs("p",{className:"text-sm text-gray-500",children:["for ",s.duration_days," days"]})]}),e.jsxs("ul",{className:"space-y-2 mb-4",children:[(t=s.features)==null?void 0:t.map((r,S)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm text-gray-600",children:[e.jsx("span",{className:"text-green-500 mt-0.5",children:"✓"}),r]},S)),e.jsxs("li",{className:"flex items-start gap-2 text-sm text-gray-600",children:[e.jsx("span",{className:"text-green-500 mt-0.5",children:"✓"}),"Up to ",s.max_users," users"]})]}),e.jsx("div",{className:"pt-4 border-t border-gray-100 mb-4",children:e.jsxs("p",{className:"text-sm text-gray-500",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:s.active_subscriptions_count||0})," ","active subscriptions"]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>C(s),className:"flex-1 btn-secondary flex items-center justify-center gap-2 text-sm",children:[e.jsx(I,{className:"w-4 h-4"}),"Edit"]}),e.jsx("button",{onClick:()=>{confirm("Are you sure you want to delete this plan?")&&_.mutate(s.id)},disabled:s.active_subscriptions_count>0,className:"btn text-red-600 hover:bg-red-50 disabled:opacity-50 disabled:cursor-not-allowed",title:s.active_subscriptions_count>0?"Cannot delete plan with active subscriptions":"",children:e.jsx(A,{className:"w-4 h-4"})})]})]},s.id)})}),e.jsx(E,{isOpen:f,onClose:c,title:l?"Edit Plan":"Create Plan",size:"lg",children:e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Plan Name"}),e.jsx("input",{type:"text",className:"input",value:a.name,onChange:s=>i({...a,name:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Slug (optional)"}),e.jsx("input",{type:"text",className:"input",value:a.slug,onChange:s=>i({...a,slug:s.target.value}),placeholder:"auto-generated if empty"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Price (BDT)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",className:"input",value:a.price,onChange:s=>i({...a,price:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Duration (Days)"}),e.jsx("input",{type:"number",min:"1",className:"input",value:a.duration_days,onChange:s=>i({...a,duration_days:s.target.value}),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Max Users"}),e.jsx("input",{type:"number",min:"1",className:"input",value:a.max_users,onChange:s=>i({...a,max_users:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Sort Order"}),e.jsx("input",{type:"number",min:"0",className:"input",value:a.sort_order,onChange:s=>i({...a,sort_order:s.target.value})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Features"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"text",className:"input flex-1",value:x,onChange:s=>p(s.target.value),placeholder:"Add a feature...",onKeyPress:s=>s.key==="Enter"&&(s.preventDefault(),v())}),e.jsx("button",{type:"button",onClick:v,className:"btn-secondary",children:"Add"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:a.features.map((s,t)=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-sm",children:[s,e.jsx("button",{type:"button",onClick:()=>w(t),className:"hover:text-red-600",children:"×"})]},t))})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"is_active",checked:a.is_active,onChange:s=>i({...a,is_active:s.target.checked}),className:"w-4 h-4 text-blue-600 rounded"}),e.jsx("label",{htmlFor:"is_active",className:"text-sm text-gray-700",children:"Plan is active and visible to users"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"submit",className:"btn-primary",disabled:h.isPending||b.isPending,children:h.isPending||b.isPending?"Saving...":l?"Update Plan":"Create Plan"}),e.jsx("button",{type:"button",onClick:c,className:"btn-secondary",children:"Cancel"})]})]})})]})}export{L as default};
