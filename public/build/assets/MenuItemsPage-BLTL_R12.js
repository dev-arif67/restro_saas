import{i as E,r as n,j as e,L as q,z as o,m as r,k as A}from"./index-CGzGCCal.js";import{u as w}from"./useQuery-B-VUE0ak.js";import{u as b}from"./useMutation-BwYhN-QW.js";import{M as D}from"./Modal-B5_Zfgyv.js";import{y as C}from"./index-BX6eEVf5.js";import"./iconBase-Bj3tzzhS.js";function V(){const m=E(),[I,f]=n.useState(!1),[t,v]=n.useState(null),[u,_]=n.useState(""),[i,c]=n.useState(null),[y,d]=n.useState(null),x=n.useRef(null),{data:p,isLoading:S}=w({queryKey:["menu-items",u],queryFn:()=>r.list({search:u,per_page:100}).then(s=>s.data.data)}),{data:h}=w({queryKey:["categories"],queryFn:()=>A.list().then(s=>s.data.data)}),k=b({mutationFn:s=>r.toggle(s),onSuccess:()=>{m.invalidateQueries(["menu-items"]),o.success("Availability toggled")}}),F=b({mutationFn:s=>r.delete(s),onSuccess:()=>{m.invalidateQueries(["menu-items"]),o.success("Item deleted")}}),g=b({mutationFn:s=>t?r.update(t.id,s):r.create(s),onSuccess:()=>{m.invalidateQueries(["menu-items"]),j(),o.success(t?"Item updated":"Item created")},onError:s=>{var a,l;return o.error(((l=(a=s.response)==null?void 0:a.data)==null?void 0:l.message)||"Error")}}),j=()=>{f(!1),v(null),c(null),d(null)},N=(s=null)=>{v(s),c((s==null?void 0:s.image_url)||null),d(null),f(!0)},P=s=>{const a=s.target.files[0];a&&(d(a),c(URL.createObjectURL(a)))},M=s=>{s.preventDefault();const a=new FormData,l=Object.fromEntries(new FormData(s.target));a.append("name",l.name),a.append("price",l.price),l.category_id&&a.append("category_id",l.category_id),l.description&&a.append("description",l.description),a.append("is_active",s.target.is_active.checked?"1":"0"),y&&a.append("image",y),g.mutate(a)};return S?e.jsx(q,{}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-800",children:"Menu Items"}),e.jsx("button",{onClick:()=>N(),className:"btn-primary text-sm sm:text-base",children:"+ Add Item"})]}),e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",className:"input max-w-xs",placeholder:"Search items...",value:u,onChange:s=>_(s.target.value)})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:p==null?void 0:p.map(s=>{var a;return e.jsxs("div",{className:`card ${s.is_active?"":"opacity-60"}`,children:[s.image_url?e.jsx("div",{className:"w-full h-40 rounded-lg overflow-hidden mb-3 bg-gray-100",children:e.jsx("img",{src:s.image_url,alt:s.name,className:"w-full h-full object-cover"})}):e.jsx("div",{className:"w-full h-40 rounded-lg mb-3 bg-gray-50 flex items-center justify-center",children:e.jsx(C,{className:"w-10 h-10 text-gray-300"})}),e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:((a=s.category)==null?void 0:a.name)||"Uncategorized"}),e.jsxs("p",{className:"text-lg font-bold text-blue-600 mt-2",children:["৳",s.price]})]}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${s.is_active?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:s.is_active?"Active":"Inactive"})]}),s.description&&e.jsx("p",{className:"text-sm text-gray-400 mt-2 line-clamp-2",children:s.description}),e.jsxs("div",{className:"flex gap-2 mt-4 pt-4 border-t",children:[e.jsx("button",{onClick:()=>k.mutate(s.id),className:"text-sm text-blue-600 hover:text-blue-800",children:s.is_active?"Disable":"Enable"}),e.jsx("button",{onClick:()=>N(s),className:"text-sm text-gray-600 hover:text-gray-800",children:"Edit"}),e.jsx("button",{onClick:()=>{confirm("Delete this item?")&&F.mutate(s.id)},className:"text-sm text-red-600 hover:text-red-800",children:"Delete"})]})]},s.id)})}),e.jsx(D,{isOpen:I,onClose:j,title:t?"Edit Item":"Add Item",children:e.jsxs("form",{onSubmit:M,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Image"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{onClick:()=>{var s;return(s=x.current)==null?void 0:s.click()},className:"w-24 h-24 rounded-xl border-2 border-dashed border-gray-300 flex items-center justify-center overflow-hidden bg-gray-50 cursor-pointer hover:border-blue-400 transition",children:i?e.jsx("img",{src:i,alt:"Preview",className:"w-full h-full object-cover"}):e.jsx(C,{className:"w-8 h-8 text-gray-400"})}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("button",{type:"button",onClick:()=>{var s;return(s=x.current)==null?void 0:s.click()},className:"text-sm text-blue-600 hover:text-blue-800",children:i?"Change Image":"Upload Image"}),i&&e.jsx("button",{type:"button",onClick:()=>{c(null),d(null)},className:"text-sm text-red-600 hover:text-red-800",children:"Remove"}),e.jsx("p",{className:"text-xs text-gray-400",children:"JPG, PNG. Max 2MB"})]})]}),e.jsx("input",{ref:x,type:"file",accept:"image/*",className:"hidden",onChange:P})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Name"}),e.jsx("input",{name:"name",className:"input",defaultValue:t==null?void 0:t.name,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Category"}),e.jsxs("select",{name:"category_id",className:"input",defaultValue:(t==null?void 0:t.category_id)||"",children:[e.jsx("option",{value:"",children:"Uncategorized"}),h==null?void 0:h.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Price (৳)"}),e.jsx("input",{name:"price",type:"number",step:"0.01",className:"input",defaultValue:t==null?void 0:t.price,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Description"}),e.jsx("textarea",{name:"description",className:"input",rows:2,defaultValue:t==null?void 0:t.description})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{name:"is_active",type:"checkbox",defaultChecked:(t==null?void 0:t.is_active)??!0,className:"rounded"}),e.jsx("label",{className:"text-sm",children:"Available"})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"submit",className:"btn-primary",disabled:g.isPending,children:g.isPending?"Saving...":"Save"}),e.jsx("button",{type:"button",onClick:j,className:"btn-secondary",children:"Cancel"})]})]})})]})}export{V as default};
