import{r,e as I,j as e,f as P,g as z,b as F,R as B,L as H,h as V,O as U,i as D}from"./index-CanGr6k3.js";import{u as L}from"./useQuery-Dl6J-XZU.js";import{u as K}from"./cartStore-D_LEivut.js";import{P as Q}from"./PoweredBy-CKzLwhnT.js";import{c as i,S as T}from"./sparkles-DnDJzz0X.js";import{S as W}from"./star-CEHK2ngD.js";import{L as J}from"./loader-circle-Dzz0qqWW.js";import{x as X}from"./index-c6C0Wc7z.js";import"./iconBase-CaRTzVFD.js";/**
 * @license lucide-react v0.575.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]],G=i("bot",Z);/**
 * @license lucide-react v0.575.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]],ee=i("leaf",Y);/**
 * @license lucide-react v0.575.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],te=i("menu",se);/**
 * @license lucide-react v0.575.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]],O=i("message-circle",ae);/**
 * @license lucide-react v0.575.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],ne=i("search",re);/**
 * @license lucide-react v0.575.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],oe=i("send",le);/**
 * @license lucide-react v0.575.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],ie=i("user",ce);/**
 * @license lucide-react v0.575.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],q=i("x",de),xe={menu:te,star:W,leaf:ee,search:ne},me=({tenantSlug:n,primaryColor:l="#ED802A"})=>{const[x,N]=r.useState(!1),[m,u]=r.useState([]),[p,y]=r.useState(""),[c,h]=r.useState(!1),[o,b]=r.useState(null),[j,t]=r.useState([]),[R,_]=r.useState(""),g=r.useRef(null),v=r.useRef(null);r.useEffect(()=>{x&&m.length===0&&k()},[x]),r.useEffect(()=>{f()},[m]);const f=()=>{var s;(s=g.current)==null||s.scrollIntoView({behavior:"smooth"})},k=async()=>{try{const s=await I.getSuggestions(n);t(s.data.suggestions||[]),_(s.data.welcome_message||""),s.data.welcome_message&&u([{role:"assistant",content:s.data.welcome_message,timestamp:new Date}])}catch(s){console.error("Failed to load suggestions:",s)}},a=async s=>{var S;if(!s.trim()||c)return;const w={role:"user",content:s.trim(),timestamp:new Date};u($=>[...$,w]),y(""),h(!0);try{const d=(await I.chat(n,s,o)).data;d.session_id&&!o&&b(d.session_id),d.suggestions&&t(d.suggestions.map(C=>({text:C}))),u(C=>[...C,{role:"assistant",content:d.message,timestamp:new Date}])}catch{u(d=>[...d,{role:"assistant",content:"Sorry, I'm having trouble responding right now. Please try again.",timestamp:new Date,error:!0}])}finally{h(!1),(S=v.current)==null||S.focus()}},M=s=>{s.preventDefault(),a(p)},E=s=>{a(s)},A=s=>new Date(s).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>N(!x),className:"fixed bottom-20 right-4 z-50 w-14 h-14 rounded-full shadow-lg flex items-center justify-center transition-all transform hover:scale-105 active:scale-95",style:{backgroundColor:l},children:x?e.jsx(q,{className:"w-6 h-6 text-white"}):e.jsx(O,{className:"w-6 h-6 text-white"})}),x&&e.jsxs("div",{className:"fixed bottom-36 right-4 z-50 w-[340px] max-w-[calc(100vw-32px)] bg-white rounded-2xl shadow-2xl border border-gray-200 overflow-hidden flex flex-col",style:{maxHeight:"calc(100vh - 200px)"},children:[e.jsxs("div",{className:"px-4 py-3 flex items-center gap-3",style:{backgroundColor:l},children:[e.jsx("div",{className:"w-10 h-10 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx(G,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-white font-semibold text-sm",children:"Menu Assistant"}),e.jsx("p",{className:"text-white/80 text-xs",children:"Here to help you order"})]}),e.jsx("button",{onClick:()=>N(!1),className:"p-1 hover:bg-white/20 rounded-lg transition-colors",children:e.jsx(q,{className:"w-5 h-5 text-white"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 min-h-[250px] max-h-[350px] bg-gray-50",children:[m.map((s,w)=>e.jsx("div",{className:`flex ${s.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`flex gap-2 max-w-[85%] ${s.role==="user"?"flex-row-reverse":""}`,children:[e.jsx("div",{className:`w-7 h-7 rounded-full flex items-center justify-center flex-shrink-0 ${s.role==="user"?"bg-gray-200":""}`,style:s.role==="assistant"?{backgroundColor:`${l}20`}:{},children:s.role==="user"?e.jsx(ie,{className:"w-4 h-4 text-gray-600"}):e.jsx(T,{className:"w-4 h-4",style:{color:l}})}),e.jsxs("div",{children:[e.jsx("div",{className:`px-3 py-2 rounded-2xl text-sm ${s.role==="user"?"text-white rounded-br-md":"bg-white border border-gray-100 text-gray-800 rounded-bl-md shadow-sm"} ${s.error?"bg-red-50 border-red-200 text-red-700":""}`,style:s.role==="user"&&!s.error?{backgroundColor:l}:{},children:e.jsx("div",{className:"whitespace-pre-wrap",dangerouslySetInnerHTML:{__html:s.content.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\n/g,"<br/>")}})}),e.jsx("p",{className:`text-[10px] text-gray-400 mt-1 ${s.role==="user"?"text-right":""}`,children:A(s.timestamp)})]})]})},w)),c&&e.jsx("div",{className:"flex justify-start",children:e.jsxs("div",{className:"flex gap-2 max-w-[85%]",children:[e.jsx("div",{className:"w-7 h-7 rounded-full flex items-center justify-center",style:{backgroundColor:`${l}20`},children:e.jsx(T,{className:"w-4 h-4",style:{color:l}})}),e.jsx("div",{className:"bg-white border border-gray-100 px-4 py-3 rounded-2xl rounded-bl-md shadow-sm",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-gray-300 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-2 h-2 bg-gray-300 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-2 h-2 bg-gray-300 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})]})}),e.jsx("div",{ref:g})]}),j.length>0&&m.length<=1&&e.jsxs("div",{className:"px-3 py-2 border-t border-gray-100 bg-white",children:[e.jsx("p",{className:"text-xs text-gray-400 mb-2",children:"Quick questions:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:j.slice(0,4).map((s,w)=>{const S=xe[s.icon]||O;return e.jsxs("button",{onClick:()=>E(s.text),className:"flex items-center gap-1.5 px-3 py-1.5 bg-gray-50 hover:bg-gray-100 rounded-full text-xs text-gray-700 transition-colors border border-gray-200",children:[e.jsx(S,{className:"w-3 h-3",style:{color:l}}),s.text]},w)})})]}),e.jsx("form",{onSubmit:M,className:"p-3 border-t border-gray-100 bg-white",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{ref:v,type:"text",value:p,onChange:s=>y(s.target.value),placeholder:"Ask about our menu...",className:"flex-1 px-4 py-2.5 bg-gray-50 rounded-xl text-sm border border-gray-200 focus:border-gray-300 focus:ring-2 focus:ring-gray-100 outline-none",disabled:c}),e.jsx("button",{type:"submit",disabled:c||!p.trim(),className:"px-4 py-2.5 rounded-xl text-white font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed hover:opacity-90 active:scale-95",style:{backgroundColor:l},children:c?e.jsx(J,{className:"w-5 h-5 animate-spin"}):e.jsx(oe,{className:"w-5 h-5"})})]})})]})]})};function ue(n){try{const l=`recent_orders_${n}`;return JSON.parse(localStorage.getItem(l)||"[]")}catch{return[]}}function ve(){var k;const{slug:n}=P(),[l]=z(),{setTenantId:x,setTableId:N,setOrderType:m}=K(),{branding:u}=F(),p=r.useRef(document.title),y=r.useRef((k=document.querySelector("link[rel~='icon']"))==null?void 0:k.href),[c,h]=r.useState(!1),o=l.get("table"),b=l.get("type")||(o?"dine":"parcel"),j=ue(n);B.useEffect(()=>{o&&N(parseInt(o)),m(b)},[n,o,b]);const{data:t,isLoading:R,error:_}=L({queryKey:["restaurant",n],queryFn:()=>D.restaurant(n).then(a=>a.data.data)}),{data:g}=L({queryKey:["table-info",n,o],queryFn:()=>D.table(n,o).then(a=>a.data.data),enabled:!!o&&!!n}),v=(g==null?void 0:g.table_number)||o,f=(t==null?void 0:t.primary_color)||"#3B82F6";return r.useEffect(()=>{if(t&&(t.name&&(document.title=t.name),t.favicon)){let a=document.querySelector("link[rel~='icon']");a||(a=document.createElement("link"),a.rel="icon",document.head.appendChild(a)),a.href="/storage/"+t.favicon}return()=>{document.title=p.current||u.platform_name||"RestaurantSaaS";const a=document.querySelector("link[rel~='icon']");a&&y.current&&(a.href=y.current)}},[t]),R?e.jsx(H,{fullScreen:!0}):_?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50 px-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-5xl mb-4",children:"ðŸ½ï¸"}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"Restaurant Unavailable"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"This restaurant is currently not accepting orders."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e.jsx("header",{className:"bg-white shadow-sm sticky top-0 z-40",style:{borderBottom:`3px solid ${f}`},children:e.jsxs("div",{className:"max-w-lg mx-auto px-4 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center min-w-0",children:[(t==null?void 0:t.logo)&&e.jsx("img",{src:`/storage/${t.logo}`,alt:"",className:"w-8 h-8 rounded-full mr-3 object-cover flex-shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-base font-bold text-gray-900 truncate",children:t==null?void 0:t.name}),o?e.jsxs("p",{className:"text-xs text-gray-500",children:["Table ",v," Â· Dine-in"]}):e.jsx("p",{className:"text-xs text-gray-500",children:"Takeaway Order"})]})]}),j.length>0&&e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>h(!c),className:"p-2 rounded-full hover:bg-gray-100 transition relative",title:"Recent orders",children:[e.jsx(X,{className:"w-5 h-5 text-gray-600"}),e.jsx("span",{className:"absolute top-1 right-1 w-2 h-2 rounded-full",style:{backgroundColor:f}})]}),c&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>h(!1)}),e.jsxs("div",{className:"absolute right-0 top-full mt-2 w-64 bg-white rounded-2xl shadow-xl border border-gray-100 z-50 overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b border-gray-100",children:e.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase",children:"Recent Orders"})}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:j.slice(0,5).map((a,M)=>e.jsxs(V,{to:`/order/${a.orderNumber}`,onClick:()=>h(!1),className:"flex items-center justify-between px-3 py-2.5 hover:bg-gray-50 transition",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-800",children:["#",a.orderNumber]}),e.jsxs("p",{className:"text-[11px] text-gray-400",children:[new Date(a.placedAt).toLocaleDateString()," ",new Date(a.placedAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),e.jsx("span",{className:"text-xs font-medium",style:{color:f},children:"Track â†’"})]},M))})]})]})]})]})}),(t==null?void 0:t.banner_image)&&e.jsx("div",{className:"max-w-lg mx-auto w-full",children:e.jsx("img",{src:`/storage/${t.banner_image}`,alt:"",className:"w-full h-36 object-cover"})}),e.jsx("div",{className:"max-w-lg mx-auto flex-1 w-full",children:e.jsx(U,{context:{restaurant:t,slug:n,tableId:o,orderType:b}})}),e.jsx("footer",{className:"py-4 text-center",children:e.jsx(Q,{})}),e.jsx(me,{tenantSlug:n,primaryColor:f})]})}export{ve as default};
