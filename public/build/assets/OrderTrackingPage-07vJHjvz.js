import{d as O,r as d,j as e,L as F,f as g,o as j}from"./index-C-fHFgbm.js";import{u as P}from"./useQuery-BCRd2gHe.js";import{S as k}from"./StatusBadge-Cgj_FQJZ.js";import{P as C}from"./POSInvoice-CEfJoeZS.js";import{f as D,x as f,D as T,k as I,i as L,o as A}from"./index-CmYeZnUY.js";import"./iconBase-b9VFOml0.js";const y=["placed","confirmed","preparing","ready","served","completed"],$={placed:"ðŸ“‹",confirmed:"âœ…",preparing:"ðŸ‘¨â€ðŸ³",ready:"ðŸ””",served:"ðŸ½ï¸",completed:"ðŸŽ‰"};function H(){try{return JSON.parse(localStorage.getItem("recent_orders")||"[]")}catch{return[]}}function U(){var u,p;const{orderNumber:r}=O(),[N,i]=d.useState(!1),[c,m]=d.useState(null),[l,v]=d.useState([]);d.useEffect(()=>{v(H())},[]);const{data:s,isLoading:w,refetch:_}=P({queryKey:["track-order",r],queryFn:()=>j.track(r).then(t=>t.data.data),refetchInterval:5e3,enabled:!!r}),S=async()=>{try{const t=await j.invoice(r);m(t.data.data),i(!0)}catch{m({order:s,restaurant:null}),i(!0)}};if(w)return e.jsx(F,{fullScreen:!0});if(!s)return e.jsx("div",{className:"min-h-screen bg-gray-50 py-8 px-4",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(D,{className:"w-10 h-10 text-gray-400"})}),e.jsx("p",{className:"text-xl font-bold text-gray-800",children:"Order Not Found"}),e.jsx("p",{className:"text-gray-500 mt-2 text-sm",children:"Check the order number and try again"})]}),l.length>0&&e.jsxs("div",{className:"mt-8",children:[e.jsxs("h3",{className:"font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx(f,{className:"w-4 h-4"})," Your Recent Orders"]}),e.jsx("div",{className:"space-y-2",children:l.map((t,a)=>e.jsxs(g,{to:`/order/${t.orderNumber}`,className:"flex items-center justify-between bg-white p-4 rounded-2xl shadow-sm border border-gray-100 hover:border-blue-200 transition",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-sm text-gray-900",children:["#",t.orderNumber]}),e.jsxs("p",{className:"text-xs text-gray-400 mt-0.5",children:[new Date(t.placedAt).toLocaleDateString()," at ",new Date(t.placedAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),e.jsx("span",{className:"text-blue-600 text-xs font-medium",children:"Track â†’"})]},a))})]})]})});const h=y.indexOf(s.status),n=s.payment_status==="paid",o=!["completed","cancelled"].includes(s.status);return e.jsxs("div",{className:"min-h-screen bg-gray-50 py-6 px-4",children:[e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsxs("h1",{className:"text-xl font-bold text-gray-900",children:["Order #",s.order_number]}),o&&e.jsx("button",{onClick:()=>_(),className:"p-1.5 rounded-full hover:bg-gray-100 transition text-gray-400",children:e.jsx(T,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 flex-wrap",children:[e.jsx(k,{status:s.status}),e.jsx("span",{className:"text-xs text-gray-400 px-2 py-1 bg-gray-100 rounded-full capitalize",children:s.type==="dine"?"ðŸ½ï¸ Dine-in":"ðŸ“¦ Takeaway"})]}),o&&e.jsx("p",{className:"text-xs text-gray-400 mt-2 animate-pulse",children:"Auto-refreshing every 5s"})]}),o&&e.jsxs("div",{className:"bg-white rounded-3xl p-6 shadow-sm border border-gray-100 mb-5 text-center",children:[e.jsx("div",{className:"text-5xl mb-3",children:$[s.status]||"ðŸ“‹"}),e.jsx("p",{className:"text-lg font-bold text-gray-900 capitalize",children:s.status}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[s.status==="placed"&&"Waiting for the restaurant to confirm your order",s.status==="confirmed"&&"Your order has been confirmed",s.status==="preparing"&&"The kitchen is preparing your food",s.status==="ready"&&"Your food is ready for pickup!",s.status==="served"&&"Your food has been served"]})]}),e.jsxs("div",{className:`rounded-2xl p-4 shadow-sm mb-4 ${n?"bg-green-50 border border-green-200":"bg-amber-50 border border-amber-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.payment_method==="cash"?e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(I,{className:"w-5 h-5 text-blue-600"})}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center",children:e.jsx(L,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900 text-sm",children:s.payment_method==="cash"?"Pay at Counter":"Online Payment"}),e.jsx("p",{className:`text-xs font-medium ${n?"text-green-600":"text-amber-600"}`,children:n?"âœ“ Payment Received":"â³ Payment Pending"})]})]}),e.jsxs("p",{className:"text-lg font-bold text-gray-900",children:["à§³",parseFloat(s.grand_total).toFixed(2)]})]}),s.payment_method==="cash"&&!n&&e.jsxs("p",{className:"text-xs text-amber-700 mt-3 bg-amber-100 rounded-xl p-2 text-center",children:["Please pay ",e.jsxs("strong",{children:["à§³",parseFloat(s.grand_total).toFixed(2)]})," at the counter"]}),s.payment_method==="online"&&!n&&s.payment_url&&e.jsx("a",{href:s.payment_url,className:"block mt-3 text-center bg-blue-600 text-white text-sm font-medium py-2.5 rounded-xl hover:bg-blue-700 transition",children:"Complete Payment"}),s.transaction_id&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Transaction: ",s.transaction_id]})]}),e.jsxs("button",{onClick:S,className:"w-full mb-4 flex items-center justify-center gap-2 py-3 bg-white border border-gray-200 rounded-2xl text-gray-700 font-medium text-sm hover:bg-gray-50 shadow-sm transition active:scale-[0.98]",children:[e.jsx(A,{className:"w-5 h-5"}),"View & Download Invoice"]}),s.status!=="cancelled"&&e.jsxs("div",{className:"bg-white rounded-2xl p-5 shadow-sm border border-gray-100 mb-4",children:[e.jsx("h3",{className:"font-semibold text-sm mb-4",children:"Order Progress"}),e.jsx("div",{className:"space-y-3",children:y.map((t,a)=>{const x=a<=h,b=a===h;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-7 h-7 rounded-full flex items-center justify-center flex-shrink-0 text-xs font-bold ${x?"bg-green-500 text-white":"bg-gray-100 text-gray-400"} ${b?"ring-3 ring-green-200":""}`,children:x?"âœ“":a+1}),e.jsx("p",{className:`text-sm font-medium capitalize flex-1 ${x?"text-green-700":"text-gray-400"}`,children:t}),b&&e.jsx("span",{className:"text-[10px] bg-green-100 text-green-700 px-2 py-0.5 rounded-full animate-pulse font-medium",children:"Current"})]},t)})})]}),s.status==="cancelled"&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-2xl p-5 text-center mb-4",children:e.jsx("p",{className:"text-red-600 font-bold",children:"âŒ Order Cancelled"})}),e.jsxs("div",{className:"bg-white rounded-2xl p-5 shadow-sm border border-gray-100 mb-4",children:[e.jsxs("h3",{className:"font-semibold text-sm mb-3",children:["Items (",(u=s.items)==null?void 0:u.length,")"]}),e.jsx("div",{className:"space-y-2.5",children:(p=s.items)==null?void 0:p.map(t=>{var a;return e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-full bg-gray-100 text-xs font-bold flex items-center justify-center text-gray-600",children:t.qty}),e.jsx("span",{className:"text-sm text-gray-800",children:(a=t.menu_item)==null?void 0:a.name})]}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["à§³",parseFloat(t.line_total).toFixed(2)]})]},t.id)})}),e.jsxs("div",{className:"border-t mt-3 pt-3 space-y-1.5",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"Subtotal"}),e.jsxs("span",{children:["à§³",parseFloat(s.subtotal).toFixed(2)]})]}),parseFloat(s.discount)>0&&e.jsxs("div",{className:"flex justify-between text-xs text-green-600",children:[e.jsx("span",{children:"Discount"}),e.jsxs("span",{children:["-à§³",parseFloat(s.discount).toFixed(2)]})]}),parseFloat(s.tax)>0&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"Tax"}),e.jsxs("span",{children:["à§³",parseFloat(s.tax).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between font-bold text-base pt-2 border-t border-gray-100",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["à§³",parseFloat(s.grand_total).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-5 shadow-sm border border-gray-100 mb-4",children:[e.jsx("h3",{className:"font-semibold text-sm mb-3",children:"Details"}),e.jsxs("div",{className:"text-xs space-y-2 text-gray-600",children:[s.table&&e.jsxs("p",{children:["ðŸª‘ Table: ",e.jsx("strong",{children:s.table.table_number})]}),s.customer_name&&e.jsxs("p",{children:["ðŸ‘¤ Name: ",e.jsx("strong",{children:s.customer_name})]}),s.customer_phone&&e.jsxs("p",{children:["ðŸ“ž Phone: ",e.jsx("strong",{children:s.customer_phone})]}),e.jsxs("p",{children:["ðŸ• Placed: ",new Date(s.created_at).toLocaleString()]}),s.paid_at&&e.jsxs("p",{children:["ðŸ’° Paid: ",new Date(s.paid_at).toLocaleString()]})]})]}),l.length>1&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h3",{className:"font-semibold text-sm text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx(f,{className:"w-4 h-4"})," Your Other Orders"]}),e.jsx("div",{className:"space-y-1.5",children:l.filter(t=>t.orderNumber!==r).slice(0,5).map((t,a)=>e.jsxs(g,{to:`/order/${t.orderNumber}`,className:"flex items-center justify-between bg-white p-3 rounded-xl shadow-sm border border-gray-100 text-sm hover:border-blue-200 transition",children:[e.jsxs("span",{className:"font-medium text-gray-700",children:["#",t.orderNumber]}),e.jsx("span",{className:"text-xs text-gray-400",children:new Date(t.placedAt).toLocaleDateString()})]},a))})]})]}),N&&c&&e.jsx(C,{order:c.order,restaurant:c.restaurant,onClose:()=>i(!1)})]})}export{U as default};
