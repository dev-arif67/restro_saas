import{i as _,r as A,j as e,L as J,z as o,C as i}from"./index-DOj4cv-Y.js";import{u as m}from"./useQuery-v6eG86EQ.js";import{u as C}from"./useMutation-CzbCp_v3.js";import{D as L,C as M,W as q,X as K,n as F,s as Q,P as z,Y as D,A as $}from"./index-BdfqSiwZ.js";import"./iconBase-um1MA9Tc.js";const G=({status:c})=>{switch(c){case"ok":return e.jsx($,{className:"w-6 h-6 text-green-500"});case"error":return e.jsx(D,{className:"w-6 h-6 text-red-500"});case"warning":return e.jsx(z,{className:"w-6 h-6 text-yellow-500"});default:return e.jsx(F,{className:"w-6 h-6 text-gray-400"})}};function B(){var u,y,j,p,b,f,N,v,w;_();const[c,H]=A.useState(100),{data:r,isLoading:O,refetch:P}=m({queryKey:["admin-system-health"],queryFn:()=>i.system.health().then(s=>s.data.data),refetchInterval:3e4}),{data:h,isLoading:k}=m({queryKey:["admin-system-info"],queryFn:()=>i.system.info().then(s=>s.data.data)}),{data:a,isLoading:T,refetch:g}=m({queryKey:["admin-queue-stats"],queryFn:()=>i.system.queueStats().then(s=>s.data.data),refetchInterval:1e4}),{data:l,isLoading:I,refetch:E}=m({queryKey:["admin-system-logs",c],queryFn:()=>i.system.logs(c).then(s=>s.data.data)}),n=C({mutationFn:s=>i.system.clearCache(s),onSuccess:s=>{o.success(s.data.message||"Cache cleared"),P()},onError:s=>{var t,d;return o.error(((d=(t=s.response)==null?void 0:t.data)==null?void 0:d.message)||"Failed to clear cache")}}),x=C({mutationFn:()=>i.system.retryFailedJobs(),onSuccess:s=>{o.success(s.data.message||"Jobs retried"),g()},onError:s=>{var t,d;return o.error(((d=(t=s.response)==null?void 0:t.data)==null?void 0:d.message)||"Failed to retry jobs")}}),R=s=>{switch(s){case"healthy":return"text-green-600 bg-green-50";case"degraded":return"text-yellow-600 bg-yellow-50";case"unhealthy":return"text-red-600 bg-red-50";default:return"text-gray-600 bg-gray-50"}},S=s=>{switch(s){case"error":return"text-red-500";case"warning":return"text-yellow-600";case"debug":return"text-gray-400";default:return"text-gray-600"}};return O&&k?e.jsx(J,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"System Management"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Monitor system health and manage caches"})]}),e.jsxs("div",{className:`px-4 py-2 rounded-full font-medium ${R(r==null?void 0:r.status)}`,children:["System: ",((u=r==null?void 0:r.status)==null?void 0:u.toUpperCase())||"CHECKING..."]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:(r==null?void 0:r.checks)&&Object.entries(r.checks).map(([s,t])=>e.jsx("div",{className:"bg-white rounded-xl p-5 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 capitalize",children:s}),e.jsx("p",{className:"font-semibold text-gray-900 mt-1",children:t.message}),t.driver&&e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Driver: ",t.driver]})]}),e.jsx(G,{status:t.status})]})},s))}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"System Information"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:h&&Object.entries(h).map(([s,t])=>e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase",children:s.replace(/_/g," ")}),e.jsx("p",{className:"font-medium text-gray-900",children:String(t)})]},s))})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Queue Status"}),e.jsx("button",{onClick:()=>g(),className:"text-gray-500 hover:text-gray-700",children:e.jsx(L,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Pending Jobs"}),e.jsx("span",{className:"text-2xl font-bold text-blue-600",children:((y=a==null?void 0:a.pending)==null?void 0:y.total)||0})]}),((p=(j=a==null?void 0:a.pending)==null?void 0:j.by_queue)==null?void 0:p.length)>0&&e.jsx("div",{className:"space-y-1",children:a.pending.by_queue.map(s=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:s.queue}),e.jsx("span",{className:"text-gray-700",children:s.count})]},s.queue))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Failed Jobs"}),e.jsx("span",{className:"text-2xl font-bold text-red-600",children:((b=a==null?void 0:a.failed)==null?void 0:b.total)||0})]}),((f=a==null?void 0:a.failed)==null?void 0:f.total)>0&&e.jsx("button",{onClick:()=>x.mutate(),disabled:x.isPending,className:"btn-secondary w-full text-sm mt-2",children:x.isPending?"Retrying...":"Retry All Failed Jobs"})]})]}),((v=(N=a==null?void 0:a.failed)==null?void 0:N.recent)==null?void 0:v.length)>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-2",children:"Recent Failures"}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:a.failed.recent.map(s=>e.jsxs("div",{className:"text-xs bg-red-50 p-2 rounded",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-mono text-red-700",children:s.queue}),e.jsx("span",{className:"text-red-500",children:s.failed_at})]}),e.jsx("p",{className:"text-red-600 truncate mt-1",children:s.exception_preview})]},s.id))})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Cache Management"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[e.jsxs("button",{onClick:()=>n.mutate("all"),disabled:n.isPending,className:"btn-secondary flex flex-col items-center gap-2 py-4",children:[e.jsx(M,{className:"w-5 h-5"}),"Clear All"]}),e.jsxs("button",{onClick:()=>n.mutate("cache"),disabled:n.isPending,className:"btn-secondary flex flex-col items-center gap-2 py-4",children:[e.jsx(q,{className:"w-5 h-5"}),"App Cache"]}),e.jsxs("button",{onClick:()=>n.mutate("config"),disabled:n.isPending,className:"btn-secondary flex flex-col items-center gap-2 py-4",children:[e.jsx(K,{className:"w-5 h-5"}),"Config"]}),e.jsxs("button",{onClick:()=>n.mutate("routes"),disabled:n.isPending,className:"btn-secondary flex flex-col items-center gap-2 py-4",children:[e.jsx(F,{className:"w-5 h-5"}),"Routes"]}),e.jsxs("button",{onClick:()=>n.mutate("views"),disabled:n.isPending,className:"btn-secondary flex flex-col items-center gap-2 py-4",children:[e.jsx(Q,{className:"w-5 h-5"}),"Views"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Recent Logs"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:c,onChange:s=>H(parseInt(s.target.value)),className:"input w-24 py-1 text-sm",children:[e.jsx("option",{value:50,children:"50 lines"}),e.jsx("option",{value:100,children:"100 lines"}),e.jsx("option",{value:200,children:"200 lines"}),e.jsx("option",{value:500,children:"500 lines"})]}),e.jsx("button",{onClick:()=>E(),className:"text-gray-500 hover:text-gray-700",children:e.jsx(L,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"bg-gray-900 rounded-lg p-4 max-h-96 overflow-y-auto font-mono text-xs",children:I?e.jsx("p",{className:"text-gray-500",children:"Loading logs..."}):((w=l==null?void 0:l.logs)==null?void 0:w.length)>0?l.logs.map((s,t)=>e.jsx("div",{className:`${S(s.level)} whitespace-pre-wrap break-all`,children:s.line},t)):e.jsx("p",{className:"text-gray-500",children:"No logs available"})}),(l==null?void 0:l.total_lines)&&e.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:["Showing ",l.showing," of ",l.total_lines," total lines"]})]})]})}export{B as default};
