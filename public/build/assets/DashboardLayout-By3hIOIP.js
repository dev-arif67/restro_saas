import{r,j as e,z as R,a as P,u as T,b as q,c as B,d as U,O as K,N as I}from"./index-BzAOpcNr.js";import{P as V}from"./PoweredBy-DdD1qB1B.js";import{u as X}from"./useQuery-CZF3df-b.js";import{u as Q}from"./useMutation-DsUlt__W.js";import{H as W,a as D,b as G,c as J,d as Y,e as Z,f as ee}from"./index-B62ZSiyr.js";import{H as L,a as se,b as ae,c as te,d as ne,e as re,f as M,g as F,h as le,i as ie,j as oe,k as $,l as de,m as ce,n as me,o as ue,p as z,q as xe,r as he,s as ge,t as fe,u as be,v as pe,w as ye}from"./index-CSl-U68a.js";import"./iconBase-bw2gwbay.js";function je(){const[a,y]=r.useState(!1),[g,c]=r.useState(""),[f,u]=r.useState([]),[x,b]=r.useState(null),[H,j]=r.useState(!0),p=r.useRef(null),O=r.useRef(null),{data:h}=X({queryKey:["ai-suggestions"],queryFn:async()=>(await P.suggestions()).data.data,enabled:a,staleTime:1e3*60*30}),m=Q({mutationFn:async({question:s})=>(await P.ask(s,x)).data.data,onSuccess:s=>{u(l=>[...l,{role:"assistant",content:s.answer,chart:s.chart}]),b(s.conversation_id),j(!1)},onError:s=>{var n,o;const l=((o=(n=s.response)==null?void 0:n.data)==null?void 0:o.message)||"Failed to get response";u(d=>[...d,{role:"assistant",content:`Sorry, ${l}`,isError:!0}]),R.error(l)}});r.useEffect(()=>{var s;(s=p.current)==null||s.scrollIntoView({behavior:"smooth"})},[f]),r.useEffect(()=>{a&&setTimeout(()=>{var s;return(s=O.current)==null?void 0:s.focus()},100)},[a]);const N=s=>{if(s.preventDefault(),!g.trim()||m.isPending)return;const l=g.trim();u(n=>[...n,{role:"user",content:l}]),c(""),m.mutate({question:l})},v=s=>{u(l=>[...l,{role:"user",content:s}]),m.mutate({question:s})},w=()=>{u([]),b(null),j(!0)},_=s=>{if(!s||!s.data||s.data.length===0)return null;const l=Math.max(...s.data.map(n=>n.revenue||n.orders||n.quantity_sold||0));return e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-2",children:s.title}),e.jsx("div",{className:"space-y-1.5",children:s.data.slice(0,5).map((n,o)=>{const d=n.revenue||n.orders||n.quantity_sold||0,k=l>0?d/l*100:0,C=n.name||n.date||n.hour||n.category||`Item ${o+1}`;return e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{className:"w-20 truncate text-gray-600",children:C}),e.jsx("div",{className:"flex-1 h-4 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-orange-500 rounded-full transition-all",style:{width:`${k}%`}})}),e.jsx("span",{className:"w-16 text-right text-gray-700 font-medium",children:typeof d=="number"&&d>100?`à§³${d.toLocaleString()}`:d})]},o)})})]})};return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>y(!a),className:`fixed bottom-6 right-6 z-50 w-14 h-14 rounded-full shadow-lg flex items-center justify-center transition-all duration-300 ${a?"bg-gray-700 rotate-90":"bg-orange-500 hover:bg-orange-600"}`,title:"AI Analytics Assistant",children:a?e.jsx(W,{className:"w-6 h-6 text-white"}):e.jsx(D,{className:"w-6 h-6 text-white"})}),a&&e.jsxs("div",{className:"fixed bottom-24 right-6 z-50 w-96 max-w-[calc(100vw-3rem)] bg-white rounded-2xl shadow-2xl border border-gray-200 flex flex-col overflow-hidden animate-in slide-in-from-bottom-4 duration-300",children:[e.jsxs("div",{className:"bg-gradient-to-r from-orange-500 to-orange-600 px-4 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5 text-white"}),e.jsx("h3",{className:"text-white font-semibold",children:"AI Analytics Assistant"})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("button",{onClick:w,className:"p-1.5 hover:bg-white/20 rounded-lg transition-colors",title:"New conversation",children:e.jsx(G,{className:"w-4 h-4 text-white"})})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 max-h-96 min-h-[300px]",children:[f.length===0&&H&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx(J,{className:"w-6 h-6 text-orange-600"})}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Ask me anything about your restaurant's performance!"})]}),h&&e.jsx("div",{className:"space-y-3",children:h.slice(0,2).map((s,l)=>e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-400 uppercase mb-1.5",children:s.category}),e.jsx("div",{className:"space-y-1.5",children:s.questions.slice(0,2).map((n,o)=>e.jsx("button",{onClick:()=>v(n),className:"w-full text-left text-sm px-3 py-2 bg-gray-50 hover:bg-orange-50 rounded-lg text-gray-700 hover:text-orange-700 transition-colors",children:n},o))})]},l))})]}),f.map((s,l)=>e.jsx("div",{className:`flex ${s.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] rounded-2xl px-4 py-2.5 ${s.role==="user"?"bg-orange-500 text-white rounded-br-md":s.isError?"bg-red-50 text-red-700 rounded-bl-md":"bg-gray-100 text-gray-800 rounded-bl-md"}`,children:[e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s.content}),s.chart&&_(s.chart)]})},l)),m.isPending&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-gray-100 rounded-2xl rounded-bl-md px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-orange-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-2 h-2 bg-orange-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-2 h-2 bg-orange-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),e.jsx("span",{className:"text-xs text-gray-500",children:"Analyzing..."})]})})}),e.jsx("div",{ref:p})]}),e.jsx("form",{onSubmit:N,className:"p-3 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{ref:O,type:"text",value:g,onChange:s=>c(s.target.value),placeholder:"Ask about your sales, orders, menu...",className:"flex-1 px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent",disabled:m.isPending}),e.jsx("button",{type:"submit",disabled:!g.trim()||m.isPending,className:"p-2.5 bg-orange-500 text-white rounded-xl hover:bg-orange-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(Y,{className:"w-5 h-5"})})]})})]})]})}const Ne=[{icon:F,label:"Dashboard",to:"/dashboard",roles:["restaurant_admin","staff"]},{icon:xe,label:"POS Terminal",to:"/dashboard/pos",roles:["restaurant_admin","staff"]},{icon:he,label:"Orders",to:"/dashboard/orders",roles:["restaurant_admin","staff"]},{icon:M,label:"Menu Items",to:"/dashboard/menu",roles:["restaurant_admin"]},{icon:ge,label:"Categories",to:"/dashboard/categories",roles:["restaurant_admin"]},{icon:fe,label:"Tables",to:"/dashboard/tables",roles:["restaurant_admin","staff"]},{icon:be,label:"Vouchers",to:"/dashboard/vouchers",roles:["restaurant_admin"]},{icon:pe,label:"Reports",to:"/dashboard/reports",roles:["restaurant_admin"]},{icon:$,label:"Settlements",to:"/dashboard/settlements",roles:["restaurant_admin"]},{icon:ye,label:"Users",to:"/dashboard/users",roles:["restaurant_admin"]},{icon:z,label:"Settings",to:"/dashboard/settings",roles:["restaurant_admin"]}],ve=[{icon:F,label:"Dashboard",to:"/dashboard/admin",roles:["super_admin"]},{icon:le,label:"Tenants",to:"/dashboard/admin/tenants",roles:["super_admin"]},{icon:ie,label:"Subscriptions",to:"/dashboard/admin/subscriptions",roles:["super_admin"]},{icon:oe,label:"Plans",to:"/dashboard/admin/plans",roles:["super_admin"]},{icon:$,label:"Financials",to:"/dashboard/admin/financials",roles:["super_admin"]},{icon:de,label:"Announcements",to:"/dashboard/admin/announcements",roles:["super_admin"]},{icon:ce,label:"Enquiries",to:"/dashboard/admin/enquiries",roles:["super_admin"]},{icon:me,label:"System",to:"/dashboard/admin/system",roles:["super_admin"]},{icon:ue,label:"Audit Logs",to:"/dashboard/admin/audit-logs",roles:["super_admin"]},{icon:z,label:"Platform Settings",to:"/dashboard/admin/settings",roles:["super_admin"]}],we=a=>a==="super_admin"?ve:Ne.filter(y=>y.roles.includes(a));function Ee(){var d,k,C;const{user:a,logout:y,updateUser:g}=T(),{branding:c}=q(),f=B(),[u,x]=r.useState(!1),[b,H]=r.useState(!1),[j,p]=r.useState(!1),[O,h]=r.useState(!1),[m,N]=r.useState(!1),v=r.useRef(null),w=r.useRef(null),_=()=>{y(),f("/login")},s=r.useCallback(()=>{document.fullscreenElement?document.exitFullscreen().then(()=>p(!1)).catch(()=>{}):document.documentElement.requestFullscreen().then(()=>p(!0)).catch(()=>{})},[]);r.useEffect(()=>{U.me().then(t=>{var S,A,E;const i=((A=(S=t.data)==null?void 0:S.data)==null?void 0:A.user)??((E=t.data)==null?void 0:E.user);i&&g(i)}).catch(()=>{})},[]),r.useEffect(()=>{const t=()=>p(!!document.fullscreenElement);return document.addEventListener("fullscreenchange",t),()=>document.removeEventListener("fullscreenchange",t)},[]),r.useEffect(()=>{const t=i=>{v.current&&!v.current.contains(i.target)&&h(!1),w.current&&!w.current.contains(i.target)&&N(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const l=we(a==null?void 0:a.role),n=b?"w-[72px]":"w-64",o=({collapsed:t=!1})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between h-16 px-4 border-b border-gray-200 shrink-0",children:[e.jsxs("div",{className:"flex items-center overflow-hidden",children:[c.platform_logo?e.jsx("img",{src:`/storage/${c.platform_logo}`,alt:c.platform_name,className:"h-8"}):e.jsx("img",{src:"/assets/images/logo.png",alt:"Logo",className:"h-8"}),!t&&c.platform_name&&e.jsx("span",{className:"ml-2 text-sm font-bold text-gray-800 truncate hidden lg:inline",children:c.platform_name})]}),e.jsx("button",{onClick:()=>x(!1),className:"md:hidden text-gray-400 hover:text-gray-600",children:e.jsx(re,{className:"w-5 h-5"})})]}),e.jsxs("nav",{className:"flex-1 px-2 py-4 space-y-1 overflow-y-auto",children:[l.map(i=>e.jsxs(I,{to:i.to,end:i.to==="/dashboard",onClick:()=>x(!1),title:t?i.label:void 0,className:({isActive:S})=>`flex items-center ${t?"justify-center px-2":"px-3"} py-2.5 text-sm font-medium rounded-lg transition-colors ${S?"bg-blue-50 text-blue-700":"text-gray-600 hover:bg-gray-100 hover:text-gray-900"}`,children:[e.jsx(i.icon,{className:"w-5 h-5 shrink-0"}),!t&&e.jsx("span",{className:"ml-3 truncate",children:i.label})]},i.to)),(a==null?void 0:a.role)!=="super_admin"&&e.jsxs(I,{to:"/kitchen",onClick:()=>x(!1),title:t?"Kitchen Display":void 0,className:`flex items-center ${t?"justify-center px-2":"px-3"} py-2.5 text-sm font-medium text-gray-600 hover:bg-gray-100 rounded-lg`,children:[e.jsx(M,{className:"w-5 h-5 shrink-0"}),!t&&e.jsx("span",{className:"ml-3",children:"Kitchen Display"})]})]}),!t&&e.jsx("div",{className:"border-t border-gray-200 p-4 shrink-0",children:(a==null?void 0:a.role)!=="super_admin"&&e.jsx("div",{className:"text-center",children:e.jsx(V,{})})})]});return e.jsxs("div",{className:"flex h-screen bg-gray-50",children:[u&&e.jsxs("div",{className:"fixed inset-0 z-40 md:hidden",children:[e.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:()=>x(!1)}),e.jsx("aside",{className:"fixed inset-y-0 left-0 z-50 w-64 bg-white flex flex-col shadow-xl",children:e.jsx(o,{collapsed:!1})})]}),e.jsx("aside",{className:`hidden md:flex md:flex-col ${n} bg-white border-r border-gray-200 shrink-0 transition-all duration-300`,children:e.jsx(o,{collapsed:b})}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[e.jsxs("header",{className:"flex items-center justify-between h-16 px-4 md:px-6 bg-white border-b border-gray-200 sticky top-0 z-30 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>x(!0),className:"md:hidden text-gray-500 hover:text-gray-700 p-1.5 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx(L,{className:"w-6 h-6"})}),e.jsx("button",{onClick:()=>H(t=>!t),className:"hidden md:flex text-gray-500 hover:text-gray-700 p-1.5 rounded-lg hover:bg-gray-100 transition-colors",title:b?"Expand sidebar":"Collapse sidebar",children:e.jsx(L,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("button",{onClick:s,className:"hidden sm:flex text-gray-500 hover:text-gray-700 p-2 rounded-lg hover:bg-gray-100 transition-colors",title:j?"Exit fullscreen":"Fullscreen",children:j?e.jsx(Z,{className:"w-5 h-5"}):e.jsx(ee,{className:"w-5 h-5"})}),e.jsxs("div",{className:"relative",ref:w,children:[e.jsxs("button",{onClick:()=>{N(t=>!t),h(!1)},className:"relative text-gray-500 hover:text-gray-700 p-2 rounded-lg hover:bg-gray-100 transition-colors",title:"Notifications",children:[e.jsx(se,{className:"w-5 h-5"}),e.jsx("span",{className:"absolute top-1.5 right-1.5 w-2 h-2 bg-red-500 rounded-full ring-2 ring-white"})]}),m&&e.jsxs("div",{className:"absolute right-0 mt-2 w-80 bg-white rounded-xl shadow-lg ring-1 ring-gray-200 z-50",children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-100",children:e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Notifications"})}),e.jsx("div",{className:"max-h-72 overflow-y-auto divide-y divide-gray-100",children:e.jsx("div",{className:"px-4 py-8 text-center text-sm text-gray-400",children:"No new notifications"})})]})]}),e.jsxs("div",{className:"relative",ref:v,children:[e.jsxs("button",{onClick:()=>{h(t=>!t),N(!1)},className:"flex items-center gap-2 p-1.5 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white text-sm font-medium shrink-0",children:(k=(d=a==null?void 0:a.name)==null?void 0:d[0])==null?void 0:k.toUpperCase()}),e.jsxs("div",{className:"hidden sm:block text-left min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 truncate max-w-[120px]",children:a==null?void 0:a.name}),e.jsx("p",{className:"text-xs text-gray-400 capitalize",children:(C=a==null?void 0:a.role)==null?void 0:C.replace("_"," ")})]}),e.jsx(ae,{className:"w-4 h-4 text-gray-400 hidden sm:block"})]}),O&&e.jsxs("div",{className:"absolute right-0 mt-2 w-56 bg-white rounded-xl shadow-lg ring-1 ring-gray-200 z-50 py-1",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:a==null?void 0:a.name}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:a==null?void 0:a.email})]}),e.jsxs("button",{onClick:()=>{h(!1),f("/dashboard/settings")},className:"flex items-center w-full px-4 py-2.5 text-sm text-gray-700 hover:bg-gray-50 transition-colors",children:[e.jsx(te,{className:"w-4 h-4 mr-3 text-gray-400"}),"Profile & Settings"]}),e.jsx("div",{className:"border-t border-gray-100",children:e.jsxs("button",{onClick:_,className:"flex items-center w-full px-4 py-2.5 text-sm text-red-600 hover:bg-red-50 transition-colors",children:[e.jsx(ne,{className:"w-4 h-4 mr-3"}),"Logout"]})})]})]})]})]}),e.jsx("main",{className:"flex-1 overflow-y-auto",children:e.jsx("div",{className:"p-4 md:p-6 lg:p-8",children:e.jsx(K,{})})})]}),(a==null?void 0:a.role)==="restaurant_admin"&&e.jsx(je,{})]})}export{Ee as default};
