import{f as G,c as Q,g as W,G as X,r as c,j as e,h as J,i as z,z as b}from"./index-CanGr6k3.js";import{u as Z}from"./useMutation-BXy1fQRg.js";import{u as ee}from"./cartStore-D_LEivut.js";import{L as te,F as se,c as ae,M as re,N as le,u as oe,k as ne,i as ce,x as de,o as ie}from"./index-c6C0Wc7z.js";import"./iconBase-CaRTzVFD.js";function me(o,p){try{const h=`recent_orders_${o}`,a=JSON.parse(localStorage.getItem(h)||"[]"),m=[{orderNumber:p,placedAt:new Date().toISOString()},...a.filter(g=>g.orderNumber!==p)].slice(0,10);localStorage.setItem(h,JSON.stringify(m));const j="recent_orders",N=JSON.parse(localStorage.getItem(j)||"[]"),S=[{orderNumber:p,slug:o,placedAt:new Date().toISOString()},...N.filter(g=>g.orderNumber!==p)].slice(0,20);localStorage.setItem(j,JSON.stringify(S))}catch{}}function ge(){const{slug:o}=G(),p=Q(),[h]=W(),{restaurant:a,tableId:f}=X()||{},{items:m,removeItem:j,updateQty:N,clearCart:F,getSubtotal:S,getOrderPayload:g,setNotes:B}=ee(),r=(a==null?void 0:a.primary_color)||"#3B82F6",[v,I]=c.useState(""),[l,O]=c.useState(null),[H,A]=c.useState(!1),[n,L]=c.useState(f?"dine":"parcel"),[s,w]=c.useState("cash"),[x,T]=c.useState(""),[u,q]=c.useState(""),[E,U]=c.useState(""),[M,Y]=c.useState(!1);c.useEffect(()=>{try{const t=JSON.parse(localStorage.getItem(`customer_info_${o}`)||"{}");t.name&&T(t.name),t.phone&&q(t.phone)}catch{}},[o]);const y=S(),P=l?l.type==="percentage"?y*(l.discount_value/100):Math.min(l.discount_value,y):0,C=parseFloat((a==null?void 0:a.default_vat_rate)??(a==null?void 0:a.tax_rate)??0),V=(a==null?void 0:a.vat_inclusive)||!1,_=Math.max(y-P,0),D=V?_*(C/(100+C)):_*(C/100),k=V?_:_+D,R=async()=>{var t,d;if(v.trim()){A(!0);try{const{data:i}=await z.validateVoucher(o,v,y);O(i.data.voucher),b.success("Voucher applied!")}catch(i){O(null),b.error(((d=(t=i.response)==null?void 0:t.data)==null?void 0:d.message)||"Invalid voucher")}finally{A(!1)}}},$=Z({mutationFn:t=>z.placeOrder(o,t),onSuccess:t=>{const d=t.data.data,i=d.order_number;if(x||u)try{localStorage.setItem(`customer_info_${o}`,JSON.stringify({name:x,phone:u}))}catch{}if(me(o,i),F(),s==="online"&&d.payment_url){Y(!0),b.success("Redirecting to payment..."),window.location.href=d.payment_url;return}b.success("Order placed!"),p(`/order/${i}`)},onError:t=>{var d,i;return b.error(((i=(d=t.response)==null?void 0:d.data)==null?void 0:i.message)||"Order failed")}}),K=()=>{if(m.length===0)return b.error("Cart is empty");if(n==="parcel"&&(!x||!u))return b.error("Name and phone required for takeaway");const t={...g(),type:n,tenant_slug:o,table_id:f||null,voucher_code:(l==null?void 0:l.code)||void 0,customer_name:x||void 0,customer_phone:u||void 0,payment_method:s,notes:E||void 0};$.mutate(t)};return e.jsxs("div",{className:"pb-32 px-3",children:[e.jsxs("div",{className:"flex items-center gap-3 py-4",children:[e.jsx(J,{to:`/restaurant/${o}?${h.toString()}`,className:"w-9 h-9 rounded-full bg-gray-100 flex items-center justify-center hover:bg-gray-200 transition",children:e.jsx(te,{className:"w-5 h-5 text-gray-600"})}),e.jsxs("h2",{className:"text-lg font-bold text-gray-900",children:["Your Cart (",m.length,")"]})]}),m.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(se,{className:"w-16 h-16 text-gray-200 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 text-lg font-medium",children:"Your cart is empty"}),e.jsx(J,{to:`/restaurant/${o}?${h.toString()}`,className:"inline-block mt-3 px-6 py-2.5 rounded-full text-white text-sm font-medium",style:{backgroundColor:r},children:"Browse Menu"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2.5 mb-5",children:m.map(t=>e.jsxs("div",{className:"bg-white rounded-2xl p-3.5 shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-sm truncate",children:t.name}),e.jsxs("p",{className:"text-xs font-bold mt-0.5",style:{color:r},children:["à§³",parseFloat(t.price).toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>N(t.menu_item_id,t.qty-1),className:"w-7 h-7 rounded-full bg-gray-100 text-gray-600 flex items-center justify-center text-sm font-bold active:bg-red-100 active:text-red-600 transition",children:"âˆ’"}),e.jsx("span",{className:"w-6 text-center font-bold text-sm",children:t.qty}),e.jsx("button",{onClick:()=>N(t.menu_item_id,t.qty+1),className:"w-7 h-7 rounded-full text-white flex items-center justify-center text-sm font-bold active:scale-90 transition",style:{backgroundColor:r},children:"+"})]}),e.jsxs("p",{className:"text-sm font-bold text-gray-900 w-14 text-right",children:["à§³",(t.price*t.qty).toFixed(0)]})]}),e.jsx("div",{className:"flex justify-end mt-1",children:e.jsx("button",{onClick:()=>j(t.menu_item_id),className:"text-xs text-red-400 hover:text-red-600 transition",children:"Remove"})})]},t.menu_item_id))}),e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-gray-100 mb-3",children:[e.jsx("label",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2.5 block",children:"Order Type"}),e.jsxs("div",{className:"flex gap-2",children:[f&&e.jsx("button",{onClick:()=>L("dine"),className:"flex-1 py-2.5 rounded-xl text-sm font-medium transition-all",style:n==="dine"?{backgroundColor:r,color:"#fff"}:{backgroundColor:"#f3f4f6",color:"#6b7280"},children:"ðŸ½ï¸ Dine-in"}),e.jsx("button",{onClick:()=>{L("parcel"),s==="pay_later"&&w("cash")},className:"flex-1 py-2.5 rounded-xl text-sm font-medium transition-all",style:n==="parcel"?{backgroundColor:r,color:"#fff"}:{backgroundColor:"#f3f4f6",color:"#6b7280"},children:"ðŸ“¦ Takeaway"})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-gray-100 mb-3 space-y-3",children:[e.jsxs("label",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide block",children:["Customer Info ",n==="dine"&&e.jsx("span",{className:"text-gray-400 normal-case",children:"(optional)"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{className:"w-full pl-9 pr-3 py-2.5 rounded-xl border border-gray-200 text-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none",placeholder:n==="parcel"?"Name *":"Name",value:x,onChange:t=>T(t.target.value)})]}),e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{className:"w-full pl-9 pr-3 py-2.5 rounded-xl border border-gray-200 text-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none",placeholder:n==="parcel"?"Phone *":"Phone",value:u,onChange:t=>q(t.target.value)})]})]})]}),e.jsx("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-gray-100 mb-3",children:e.jsxs("div",{className:"relative",children:[e.jsx(le,{className:"absolute left-3 top-3 text-gray-400 w-4 h-4"}),e.jsx("textarea",{className:"w-full pl-9 pr-3 py-2.5 rounded-xl border border-gray-200 text-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none resize-none",placeholder:"Special instructions or notes...",rows:2,value:E,onChange:t=>{U(t.target.value),B(t.target.value)}})]})}),e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-gray-100 mb-3",children:[e.jsx("label",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2.5 block",children:"Voucher Code"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(oe,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{className:"w-full pl-9 pr-3 py-2.5 rounded-xl border border-gray-200 text-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none disabled:bg-gray-50",placeholder:"Enter code",value:v,onChange:t=>I(t.target.value.toUpperCase()),disabled:!!l,onKeyDown:t=>t.key==="Enter"&&R()})]}),l?e.jsx("button",{onClick:()=>{O(null),I("")},className:"px-4 py-2.5 text-xs text-red-600 border border-red-200 rounded-xl hover:bg-red-50 font-medium",children:"Remove"}):e.jsx("button",{onClick:R,className:"px-5 py-2.5 rounded-xl text-white text-sm font-medium disabled:opacity-40 transition",style:{backgroundColor:"#1f2937"},disabled:!v.trim()||H,children:H?"...":"Apply"})]}),l&&e.jsxs("div",{className:"mt-2 flex items-center gap-1.5 text-green-600",children:[e.jsx("span",{className:"text-sm",children:"âœ“"}),e.jsxs("p",{className:"text-sm font-medium",children:[l.type==="percentage"?`${l.discount_value}% off`:`à§³${l.discount_value} off`," applied!"]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-gray-100 mb-3",children:[e.jsx("label",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-3 block",children:"Payment Method"}),e.jsxs("div",{className:`grid gap-3 ${n==="dine"?"grid-cols-3":"grid-cols-2"}`,children:[e.jsxs("button",{onClick:()=>w("cash"),className:`flex flex-col items-center gap-1.5 p-3 rounded-2xl border-2 transition-all ${s==="cash"?"border-blue-600 bg-blue-50":"border-gray-200 bg-white hover:border-gray-300"}`,children:[e.jsx(ne,{className:"w-6 h-6",style:{color:s==="cash"?r:"#6b7280"}}),e.jsx("span",{className:"text-xs font-medium",style:{color:s==="cash"?r:"#6b7280"},children:"Counter"})]}),e.jsxs("button",{onClick:()=>w("online"),className:`flex flex-col items-center gap-1.5 p-3 rounded-2xl border-2 transition-all ${s==="online"?"border-blue-600 bg-blue-50":"border-gray-200 bg-white hover:border-gray-300"}`,children:[e.jsx(ce,{className:"w-6 h-6",style:{color:s==="online"?r:"#6b7280"}}),e.jsx("span",{className:"text-xs font-medium",style:{color:s==="online"?r:"#6b7280"},children:"Online"})]}),n==="dine"&&e.jsxs("button",{onClick:()=>w("pay_later"),className:`flex flex-col items-center gap-1.5 p-3 rounded-2xl border-2 transition-all ${s==="pay_later"?"border-blue-600 bg-blue-50":"border-gray-200 bg-white hover:border-gray-300"}`,children:[e.jsx(de,{className:"w-6 h-6",style:{color:s==="pay_later"?r:"#6b7280"}}),e.jsx("span",{className:"text-xs font-medium",style:{color:s==="pay_later"?r:"#6b7280"},children:"Pay Later"})]})]}),s==="online"&&e.jsx("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-xl",children:e.jsx("p",{className:"text-xs text-blue-700",children:"You will be redirected to SSLCommerz secure payment gateway."})}),s==="pay_later"&&e.jsx("div",{className:"mt-3 p-3 bg-amber-50 border border-amber-200 rounded-xl",children:e.jsx("p",{className:"text-xs text-amber-700",children:"Pay at the end of your meal. A waiter will bring the bill to your table."})})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-gray-100 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 pb-2 border-b border-gray-100",children:[e.jsx(ie,{className:"w-5 h-5 text-gray-500"}),e.jsx("span",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide",children:"Order Summary"})]}),e.jsx("div",{className:"space-y-1.5 mb-3 pb-3 border-b border-dashed border-gray-200",children:m.map(t=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:[t.qty,"x ",t.name]}),e.jsxs("span",{className:"text-gray-800",children:["à§³",(t.price*t.qty).toFixed(2)]})]},t.menu_item_id))}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Subtotal"}),e.jsxs("span",{className:"font-medium",children:["à§³",y.toFixed(2)]})]}),P>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"Discount"}),e.jsxs("span",{className:"font-medium",children:["-à§³",P.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-500",children:["VAT/Tax (",C||0,"%)"]}),e.jsxs("span",{className:"font-medium",children:["à§³",D.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-base font-bold pt-2 border-t border-gray-200",children:[e.jsx("span",{children:"Total Payable"}),e.jsxs("span",{style:{color:r},children:["à§³",k.toFixed(2)]})]})]})]}),n==="parcel"&&(!(x!=null&&x.trim())||!(u!=null&&u.trim()))&&e.jsx("p",{className:"text-xs text-center text-amber-600 mb-2 bg-amber-50 rounded-xl py-2",children:"Customer name & phone required for takeaway orders"})]}),m.length>0&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-3 bg-white border-t border-gray-100 max-w-lg mx-auto safe-area-bottom",children:e.jsx("button",{onClick:K,disabled:$.isPending||M,className:"w-full py-3.5 text-white rounded-2xl text-sm font-bold transition-all active:scale-[0.98] disabled:opacity-50 shadow-lg",style:{backgroundColor:r},children:M?"Redirecting to payment...":$.isPending?"Placing order...":s==="online"?`Place Order & Pay â€” à§³${k.toFixed(2)}`:s==="pay_later"?`Place Order (Pay Later) â€” à§³${k.toFixed(2)}`:`Place Order â€” à§³${k.toFixed(2)}`})})]})}export{ge as default};
