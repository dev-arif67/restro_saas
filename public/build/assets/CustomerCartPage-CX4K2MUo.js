import{d as K,b as Q,e as G,A as W,r as n,j as e,f as R,g as J,z as b}from"./index-CGzGCCal.js";import{u as X}from"./useMutation-BwYhN-QW.js";import{u as Z}from"./cartStore-DaVEQcoT.js";import{L as ee,F as te,c as se,M as ae,N as re,u as le,k as oe,i as ne,x as ce,o as de}from"./index-BX6eEVf5.js";import"./iconBase-Bj3tzzhS.js";function ie(l,p){try{const h=`recent_orders_${l}`,i=JSON.parse(localStorage.getItem(h)||"[]"),m=[{orderNumber:p,placedAt:new Date().toISOString()},...i.filter(g=>g.orderNumber!==p)].slice(0,10);localStorage.setItem(h,JSON.stringify(m));const j="recent_orders",N=JSON.parse(localStorage.getItem(j)||"[]"),_=[{orderNumber:p,slug:l,placedAt:new Date().toISOString()},...N.filter(g=>g.orderNumber!==p)].slice(0,20);localStorage.setItem(j,JSON.stringify(_))}catch{}}function he(){const{slug:l}=K(),p=Q(),[h]=G(),{restaurant:i,tableId:f}=W()||{},{items:m,removeItem:j,updateQty:N,clearCart:P,getSubtotal:_,getOrderPayload:g,setNotes:z}=Z(),a=(i==null?void 0:i.primary_color)||"#3B82F6",[v,$]=n.useState(""),[r,k]=n.useState(null),[F,I]=n.useState(!1),[o,A]=n.useState(f?"dine":"parcel"),[s,w]=n.useState("cash"),[x,H]=n.useState(""),[u,L]=n.useState(""),[T,B]=n.useState(""),[q,U]=n.useState(!1);n.useEffect(()=>{try{const t=JSON.parse(localStorage.getItem(`customer_info_${l}`)||"{}");t.name&&H(t.name),t.phone&&L(t.phone)}catch{}},[l]);const y=_(),S=r?r.type==="percentage"?y*(r.discount_value/100):Math.min(r.discount_value,y):0,E=(i==null?void 0:i.tax_rate)||0,M=Math.max(y-S,0),V=M*(E/100),C=M+V,D=async()=>{var t,c;if(v.trim()){I(!0);try{const{data:d}=await J.validateVoucher(l,v,y);k(d.data.voucher),b.success("Voucher applied!")}catch(d){k(null),b.error(((c=(t=d.response)==null?void 0:t.data)==null?void 0:c.message)||"Invalid voucher")}finally{I(!1)}}},O=X({mutationFn:t=>J.placeOrder(l,t),onSuccess:t=>{const c=t.data.data,d=c.order_number;if(x||u)try{localStorage.setItem(`customer_info_${l}`,JSON.stringify({name:x,phone:u}))}catch{}if(ie(l,d),P(),s==="online"&&c.payment_url){U(!0),b.success("Redirecting to payment..."),window.location.href=c.payment_url;return}b.success("Order placed!"),p(`/order/${d}`)},onError:t=>{var c,d;return b.error(((d=(c=t.response)==null?void 0:c.data)==null?void 0:d.message)||"Order failed")}}),Y=()=>{if(m.length===0)return b.error("Cart is empty");if(o==="parcel"&&(!x||!u))return b.error("Name and phone required for takeaway");const t={...g(),type:o,tenant_slug:l,table_id:f||null,voucher_code:(r==null?void 0:r.code)||void 0,customer_name:x||void 0,customer_phone:u||void 0,payment_method:s,notes:T||void 0};O.mutate(t)};return e.jsxs("div",{className:"pb-32 px-3",children:[e.jsxs("div",{className:"flex items-center gap-3 py-4",children:[e.jsx(R,{to:`/restaurant/${l}?${h.toString()}`,className:"w-9 h-9 rounded-full bg-gray-100 flex items-center justify-center hover:bg-gray-200 transition",children:e.jsx(ee,{className:"w-5 h-5 text-gray-600"})}),e.jsxs("h2",{className:"text-lg font-bold text-gray-900",children:["Your Cart (",m.length,")"]})]}),m.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(te,{className:"w-16 h-16 text-gray-200 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 text-lg font-medium",children:"Your cart is empty"}),e.jsx(R,{to:`/restaurant/${l}?${h.toString()}`,className:"inline-block mt-3 px-6 py-2.5 rounded-full text-white text-sm font-medium",style:{backgroundColor:a},children:"Browse Menu"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2.5 mb-5",children:m.map(t=>e.jsxs("div",{className:"bg-white rounded-2xl p-3.5 shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-sm truncate",children:t.name}),e.jsxs("p",{className:"text-xs font-bold mt-0.5",style:{color:a},children:["à§³",parseFloat(t.price).toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>N(t.menu_item_id,t.qty-1),className:"w-7 h-7 rounded-full bg-gray-100 text-gray-600 flex items-center justify-center text-sm font-bold active:bg-red-100 active:text-red-600 transition",children:"âˆ’"}),e.jsx("span",{className:"w-6 text-center font-bold text-sm",children:t.qty}),e.jsx("button",{onClick:()=>N(t.menu_item_id,t.qty+1),className:"w-7 h-7 rounded-full text-white flex items-center justify-center text-sm font-bold active:scale-90 transition",style:{backgroundColor:a},children:"+"})]}),e.jsxs("p",{className:"text-sm font-bold text-gray-900 w-14 text-right",children:["à§³",(t.price*t.qty).toFixed(0)]})]}),e.jsx("div",{className:"flex justify-end mt-1",children:e.jsx("button",{onClick:()=>j(t.menu_item_id),className:"text-xs text-red-400 hover:text-red-600 transition",children:"Remove"})})]},t.menu_item_id))}),e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-gray-100 mb-3",children:[e.jsx("label",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2.5 block",children:"Order Type"}),e.jsxs("div",{className:"flex gap-2",children:[f&&e.jsx("button",{onClick:()=>A("dine"),className:"flex-1 py-2.5 rounded-xl text-sm font-medium transition-all",style:o==="dine"?{backgroundColor:a,color:"#fff"}:{backgroundColor:"#f3f4f6",color:"#6b7280"},children:"ðŸ½ï¸ Dine-in"}),e.jsx("button",{onClick:()=>{A("parcel"),s==="pay_later"&&w("cash")},className:"flex-1 py-2.5 rounded-xl text-sm font-medium transition-all",style:o==="parcel"?{backgroundColor:a,color:"#fff"}:{backgroundColor:"#f3f4f6",color:"#6b7280"},children:"ðŸ“¦ Takeaway"})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-gray-100 mb-3 space-y-3",children:[e.jsxs("label",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide block",children:["Customer Info ",o==="dine"&&e.jsx("span",{className:"text-gray-400 normal-case",children:"(optional)"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{className:"w-full pl-9 pr-3 py-2.5 rounded-xl border border-gray-200 text-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none",placeholder:o==="parcel"?"Name *":"Name",value:x,onChange:t=>H(t.target.value)})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{className:"w-full pl-9 pr-3 py-2.5 rounded-xl border border-gray-200 text-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none",placeholder:o==="parcel"?"Phone *":"Phone",value:u,onChange:t=>L(t.target.value)})]})]})]}),e.jsx("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-gray-100 mb-3",children:e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-3 text-gray-400 w-4 h-4"}),e.jsx("textarea",{className:"w-full pl-9 pr-3 py-2.5 rounded-xl border border-gray-200 text-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none resize-none",placeholder:"Special instructions or notes...",rows:2,value:T,onChange:t=>{B(t.target.value),z(t.target.value)}})]})}),e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-gray-100 mb-3",children:[e.jsx("label",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2.5 block",children:"Voucher Code"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(le,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{className:"w-full pl-9 pr-3 py-2.5 rounded-xl border border-gray-200 text-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none disabled:bg-gray-50",placeholder:"Enter code",value:v,onChange:t=>$(t.target.value.toUpperCase()),disabled:!!r,onKeyDown:t=>t.key==="Enter"&&D()})]}),r?e.jsx("button",{onClick:()=>{k(null),$("")},className:"px-4 py-2.5 text-xs text-red-600 border border-red-200 rounded-xl hover:bg-red-50 font-medium",children:"Remove"}):e.jsx("button",{onClick:D,className:"px-5 py-2.5 rounded-xl text-white text-sm font-medium disabled:opacity-40 transition",style:{backgroundColor:"#1f2937"},disabled:!v.trim()||F,children:F?"...":"Apply"})]}),r&&e.jsxs("div",{className:"mt-2 flex items-center gap-1.5 text-green-600",children:[e.jsx("span",{className:"text-sm",children:"âœ“"}),e.jsxs("p",{className:"text-sm font-medium",children:[r.type==="percentage"?`${r.discount_value}% off`:`à§³${r.discount_value} off`," applied!"]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-gray-100 mb-3",children:[e.jsx("label",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide mb-3 block",children:"Payment Method"}),e.jsxs("div",{className:`grid gap-3 ${o==="dine"?"grid-cols-3":"grid-cols-2"}`,children:[e.jsxs("button",{onClick:()=>w("cash"),className:`flex flex-col items-center gap-1.5 p-3 rounded-2xl border-2 transition-all ${s==="cash"?"border-blue-600 bg-blue-50":"border-gray-200 bg-white hover:border-gray-300"}`,children:[e.jsx(oe,{className:"w-6 h-6",style:{color:s==="cash"?a:"#6b7280"}}),e.jsx("span",{className:"text-xs font-medium",style:{color:s==="cash"?a:"#6b7280"},children:"Counter"})]}),e.jsxs("button",{onClick:()=>w("online"),className:`flex flex-col items-center gap-1.5 p-3 rounded-2xl border-2 transition-all ${s==="online"?"border-blue-600 bg-blue-50":"border-gray-200 bg-white hover:border-gray-300"}`,children:[e.jsx(ne,{className:"w-6 h-6",style:{color:s==="online"?a:"#6b7280"}}),e.jsx("span",{className:"text-xs font-medium",style:{color:s==="online"?a:"#6b7280"},children:"Online"})]}),o==="dine"&&e.jsxs("button",{onClick:()=>w("pay_later"),className:`flex flex-col items-center gap-1.5 p-3 rounded-2xl border-2 transition-all ${s==="pay_later"?"border-blue-600 bg-blue-50":"border-gray-200 bg-white hover:border-gray-300"}`,children:[e.jsx(ce,{className:"w-6 h-6",style:{color:s==="pay_later"?a:"#6b7280"}}),e.jsx("span",{className:"text-xs font-medium",style:{color:s==="pay_later"?a:"#6b7280"},children:"Pay Later"})]})]}),s==="online"&&e.jsx("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-xl",children:e.jsx("p",{className:"text-xs text-blue-700",children:"You will be redirected to SSLCommerz secure payment gateway."})}),s==="pay_later"&&e.jsx("div",{className:"mt-3 p-3 bg-amber-50 border border-amber-200 rounded-xl",children:e.jsx("p",{className:"text-xs text-amber-700",children:"Pay at the end of your meal. A waiter will bring the bill to your table."})})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-gray-100 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 pb-2 border-b border-gray-100",children:[e.jsx(de,{className:"w-5 h-5 text-gray-500"}),e.jsx("span",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide",children:"Order Summary"})]}),e.jsx("div",{className:"space-y-1.5 mb-3 pb-3 border-b border-dashed border-gray-200",children:m.map(t=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:[t.qty,"x ",t.name]}),e.jsxs("span",{className:"text-gray-800",children:["à§³",(t.price*t.qty).toFixed(2)]})]},t.menu_item_id))}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Subtotal"}),e.jsxs("span",{className:"font-medium",children:["à§³",y.toFixed(2)]})]}),S>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"Discount"}),e.jsxs("span",{className:"font-medium",children:["-à§³",S.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-500",children:["VAT/Tax (",E||0,"%)"]}),e.jsxs("span",{className:"font-medium",children:["à§³",V.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-base font-bold pt-2 border-t border-gray-200",children:[e.jsx("span",{children:"Total Payable"}),e.jsxs("span",{style:{color:a},children:["à§³",C.toFixed(2)]})]})]})]}),o==="parcel"&&(!(x!=null&&x.trim())||!(u!=null&&u.trim()))&&e.jsx("p",{className:"text-xs text-center text-amber-600 mb-2 bg-amber-50 rounded-xl py-2",children:"Customer name & phone required for takeaway orders"})]}),m.length>0&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-3 bg-white border-t border-gray-100 max-w-lg mx-auto safe-area-bottom",children:e.jsx("button",{onClick:Y,disabled:O.isPending||q,className:"w-full py-3.5 text-white rounded-2xl text-sm font-bold transition-all active:scale-[0.98] disabled:opacity-50 shadow-lg",style:{backgroundColor:a},children:q?"Redirecting to payment...":O.isPending?"Placing order...":s==="online"?`Place Order & Pay â€” à§³${C.toFixed(2)}`:s==="pay_later"?`Place Order (Pay Later) â€” à§³${C.toFixed(2)}`:`Place Order â€” à§³${C.toFixed(2)}`})})]})}export{he as default};
