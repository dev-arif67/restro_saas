import{c as A,b as R,d as Y,w as D,r as n,j as e,g as H,e as k,z as d}from"./index-B_U3xfNL.js";import{u as L}from"./useMutation-CUUa5Gsz.js";import{u as B}from"./cartStore-D1vKMwcE.js";import{g as K,k as Q}from"./index-BkSbYybd.js";function Z(){const{slug:o}=A(),O=R(),[S]=Y(),{restaurant:x,tableId:u}=D()||{},{items:i,addItem:U,removeItem:$,updateQty:f,clearCart:F,getSubtotal:q,getOrderPayload:T}=B(),[h,V]=n.useState(""),[t,N]=n.useState(null),[a,v]=n.useState(u?"dine":"parcel"),[c,w]=n.useState("cash"),[b,I]=n.useState(""),[p,M]=n.useState(""),m=q(),g=t?t.type==="percentage"?m*(t.discount_value/100):t.discount_value:0,C=(x==null?void 0:x.tax_rate)||0,P=m-g,j=P*(C/100),_=P+j,E=async()=>{var s,r;try{const{data:l}=await k.validateVoucher(o,h,m);N(l.data.voucher),d.success("Voucher applied!")}catch(l){N(null),d.error(((r=(s=l.response)==null?void 0:s.data)==null?void 0:r.message)||"Invalid voucher")}},y=L({mutationFn:s=>k.placeOrder(o,s),onSuccess:s=>{const r=s.data.data.order_number;F(),d.success("Order placed!"),O(`/order/${r}`)},onError:s=>{var r,l;return d.error(((l=(r=s.response)==null?void 0:r.data)==null?void 0:l.message)||"Order failed")}}),z=()=>{if(i.length===0)return d.error("Cart is empty");if(a==="parcel"&&(!b||!p))return d.error("Name and phone required for takeaway");const s={...T(),type:a,tenant_slug:o,table_id:u||null,voucher_code:(t==null?void 0:t.code)||void 0,customer_name:a==="parcel"?b:void 0,customer_phone:a==="parcel"?p:void 0,payment_method:c};y.mutate(s)};return e.jsxs("div",{className:"pb-32",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Your Cart"}),i.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-400 text-lg",children:"Your cart is empty"}),e.jsx(H,{to:`/restaurant/${o}?${S.toString()}`,className:"text-blue-600 text-sm mt-2 inline-block",children:"Browse Menu"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-3 mb-6",children:i.map(s=>e.jsxs("div",{className:"bg-white rounded-xl p-4 flex items-center justify-between shadow-sm",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium",children:s.name}),e.jsxs("p",{className:"text-sm text-blue-600 font-bold",children:["৳",s.price]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>f(s.menu_item_id,s.qty-1),className:"w-8 h-8 rounded-full bg-gray-100 text-lg flex items-center justify-center",children:"-"}),e.jsx("span",{className:"font-bold w-6 text-center",children:s.qty}),e.jsx("button",{onClick:()=>f(s.menu_item_id,s.qty+1),className:"w-8 h-8 rounded-full bg-blue-100 text-blue-600 text-lg flex items-center justify-center",children:"+"}),e.jsx("button",{onClick:()=>$(s.menu_item_id),className:"text-red-400 text-sm ml-2",children:"Remove"})]})]},s.menu_item_id))}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm mb-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Order Type"}),e.jsxs("div",{className:"flex gap-3",children:[u&&e.jsx("button",{onClick:()=>v("dine"),className:`flex-1 py-2.5 rounded-lg text-sm font-medium ${a==="dine"?"bg-blue-600 text-white":"bg-gray-100"}`,children:"Dine-in"}),e.jsx("button",{onClick:()=>v("parcel"),className:`flex-1 py-2.5 rounded-lg text-sm font-medium ${a==="parcel"?"bg-blue-600 text-white":"bg-gray-100"}`,children:"Takeaway"})]})]}),a==="parcel"&&e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm mb-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Name"}),e.jsx("input",{className:"w-full mt-1 px-3 py-2 rounded-lg border",value:b,onChange:s=>I(s.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Phone"}),e.jsx("input",{className:"w-full mt-1 px-3 py-2 rounded-lg border",value:p,onChange:s=>M(s.target.value),required:!0})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm mb-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Voucher Code"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"flex-1 px-3 py-2 rounded-lg border",placeholder:"Enter code",value:h,onChange:s=>V(s.target.value.toUpperCase())}),e.jsx("button",{onClick:E,className:"px-4 py-2 bg-gray-900 text-white rounded-lg text-sm font-medium",disabled:!h,children:"Apply"})]}),t&&e.jsxs("p",{className:"text-green-600 text-sm mt-2",children:[t.type==="percentage"?`${t.discount_value}% off`:`৳${t.discount_value} off`," applied!"]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm mb-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-3 block",children:"Payment Method"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>w("cash"),className:`flex flex-col items-center gap-2 p-4 rounded-xl border-2 transition-all ${c==="cash"?"border-blue-600 bg-blue-50 text-blue-700":"border-gray-200 bg-white text-gray-600 hover:border-gray-300"}`,children:[e.jsx(K,{className:"w-7 h-7"}),e.jsx("span",{className:"text-sm font-medium",children:"Pay at Counter"}),e.jsx("span",{className:"text-xs text-gray-400",children:"Cash / Card"})]}),e.jsxs("button",{onClick:()=>w("online"),className:`flex flex-col items-center gap-2 p-4 rounded-xl border-2 transition-all ${c==="online"?"border-blue-600 bg-blue-50 text-blue-700":"border-gray-200 bg-white text-gray-600 hover:border-gray-300"}`,children:[e.jsx(Q,{className:"w-7 h-7"}),e.jsx("span",{className:"text-sm font-medium",children:"Pay Online"}),e.jsx("span",{className:"text-xs text-gray-400",children:"bKash / SSLCommerz"})]})]}),c==="online"&&e.jsx("div",{className:"mt-3 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:e.jsxs("p",{className:"text-xs text-amber-700",children:[e.jsx("strong",{children:"Note:"})," Online payment will be available after your order is confirmed. You'll receive a payment link."]})})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm mb-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Subtotal"}),e.jsxs("span",{children:["৳",m.toFixed(2)]})]}),g>0&&e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsx("span",{children:"Discount"}),e.jsxs("span",{children:["-৳",g.toFixed(2)]})]}),j>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-gray-500",children:["Tax (",C,"%)"]}),e.jsxs("span",{children:["৳",j.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold pt-2 border-t",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["৳",_.toFixed(2)]})]})]})]}),i.length>0&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-white border-t max-w-lg mx-auto",children:e.jsx("button",{onClick:z,disabled:y.isPending,className:"w-full py-4 bg-blue-600 text-white rounded-xl text-lg font-bold hover:bg-blue-700 transition disabled:opacity-50",children:y.isPending?"Placing...":`${c==="online"?"Place Order & Pay":"Place Order"} - ৳${_.toFixed(2)}`})})]})}export{Z as default};
