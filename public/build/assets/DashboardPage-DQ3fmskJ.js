import{r as j,k as S,j as e,u as T,L as D,l as C}from"./index-CanGr6k3.js";import{u as F}from"./useQuery-Dl6J-XZU.js";import{S as $}from"./StatusBadge-CEOw6-a8.js";import{c as m,S as v}from"./sparkles-DnDJzz0X.js";import{R as _,C as A}from"./refresh-cw-C5Zscb5P.js";import{C as I}from"./clock-ccyvP83v.js";/**
 * @license lucide-react v0.575.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],E=m("calendar",M);/**
 * @license lucide-react v0.575.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],R=m("chevron-up",L);/**
 * @license lucide-react v0.575.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],B=m("circle-alert",P);/**
 * @license lucide-react v0.575.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["path",{d:"M5 12h14",key:"1ays0h"}]],q=m("minus",U);/**
 * @license lucide-react v0.575.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],z=m("trending-down",O);/**
 * @license lucide-react v0.575.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],W=m("trending-up",H),G=()=>{const[r,s]=j.useState(null),[h,d]=j.useState(!0),[g,p]=j.useState(null),[i,b]=j.useState(!1);j.useEffect(()=>{o()},[]);const o=async()=>{var t,x;d(!0),p(null);try{const f=await S.getForecast(7);s(f.data)}catch(f){p(((x=(t=f.response)==null?void 0:t.data)==null?void 0:x.error)||"Failed to load forecast")}finally{d(!1)}},u=t=>new Intl.NumberFormat("en-BD",{style:"currency",currency:"BDT",minimumFractionDigits:0,maximumFractionDigits:0}).format(t).replace("BDT","৳"),a=t=>{switch(t){case"up":return e.jsx(W,{className:"w-4 h-4 text-green-500"});case"down":return e.jsx(z,{className:"w-4 h-4 text-red-500"});default:return e.jsx(q,{className:"w-4 h-4 text-gray-500"})}},n=t=>t>=80?"text-green-600 bg-green-100":t>=60?"text-yellow-600 bg-yellow-100":"text-red-600 bg-red-100",k=t=>({Sunday:"bg-red-100 text-red-700",Monday:"bg-blue-100 text-blue-700",Tuesday:"bg-purple-100 text-purple-700",Wednesday:"bg-green-100 text-green-700",Thursday:"bg-yellow-100 text-yellow-700",Friday:"bg-orange-100 text-orange-700",Saturday:"bg-pink-100 text-pink-700"})[t]||"bg-gray-100 text-gray-700";if(h)return e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-40"}),e.jsx("div",{className:"h-6 bg-gray-200 rounded w-16"})]}),e.jsx("div",{className:"space-y-3",children:[1,2,3].map(t=>e.jsx("div",{className:"h-12 bg-gray-100 rounded"},t))})]})});if(g)return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:e.jsx(v,{className:"w-5 h-5 text-orange-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Sales Forecast"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-amber-600 bg-amber-50 p-3 rounded-lg",children:[e.jsx(B,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm",children:g})]}),e.jsxs("button",{onClick:o,className:"mt-4 text-sm text-[#ED802A] hover:underline flex items-center gap-1",children:[e.jsx(_,{className:"w-4 h-4"}),"Try again"]})]});if(!r)return null;const{summary:l,forecast:y,busy_hours:N,insights:w}=r;return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-100 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-orange-100 to-orange-200 rounded-lg",children:e.jsx(v,{className:"w-5 h-5 text-[#ED802A]"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"7-Day Forecast"}),e.jsx("p",{className:"text-xs text-gray-500",children:"AI-powered sales prediction"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`text-xs px-2 py-1 rounded-full ${n(l.confidence)}`,children:[l.confidence,"% confidence"]}),e.jsx("button",{onClick:o,className:"p-1.5 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",title:"Refresh forecast",children:e.jsx(_,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 divide-x divide-gray-100 bg-gray-50",children:[e.jsxs("div",{className:"px-4 py-3 text-center",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Predicted Revenue"}),e.jsx("p",{className:"text-lg font-bold text-gray-800",children:u(l.predicted_revenue)})]}),e.jsxs("div",{className:"px-4 py-3 text-center",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Expected Orders"}),e.jsx("p",{className:"text-lg font-bold text-gray-800",children:l.predicted_orders})]}),e.jsxs("div",{className:"px-4 py-3 text-center",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Trend"}),e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[a(l.trend),e.jsx("span",{className:`font-bold ${l.trend==="up"?"text-green-600":l.trend==="down"?"text-red-600":"text-gray-600"}`,children:l.trend==="up"?"Growing":l.trend==="down"?"Declining":"Stable"})]})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(E,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Daily Breakdown"})]}),e.jsx("div",{className:"space-y-2",children:y.slice(0,i?7:3).map((t,x)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`text-xs font-medium px-2 py-1 rounded ${k(t.day_name)}`,children:t.day_name.slice(0,3)}),e.jsx("span",{className:"text-sm text-gray-600",children:new Date(t.date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-800",children:u(t.predicted_revenue)}),e.jsxs("p",{className:"text-xs text-gray-500",children:["~",t.predicted_orders," orders"]})]}),e.jsxs("div",{className:`text-xs px-1.5 py-0.5 rounded ${n(t.confidence)}`,children:[t.confidence,"%"]})]})]},t.date))}),y.length>3&&e.jsx("button",{onClick:()=>b(!i),className:"mt-3 w-full text-center text-sm text-[#ED802A] hover:text-orange-700 flex items-center justify-center gap-1",children:i?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-4 h-4"}),"Show less"]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4"}),"Show all ",y.length," days"]})})]}),N&&N.length>0&&e.jsxs("div",{className:"px-4 pb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(I,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Peak Hours"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:N.slice(0,4).map((t,x)=>e.jsx("span",{className:"px-3 py-1.5 bg-orange-50 text-[#ED802A] rounded-full text-sm font-medium",children:t.hour||t},x))})]}),w&&e.jsxs("div",{className:"px-4 pb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(v,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"AI Insights"})]}),e.jsx("div",{className:"bg-gradient-to-r from-orange-50 to-amber-50 rounded-lg p-4 border border-orange-100",children:e.jsx("div",{className:"text-sm text-gray-700 prose prose-sm max-w-none",dangerouslySetInnerHTML:{__html:w.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\n\n/g,"<br/><br/>")}})})]}),r.cached&&e.jsx("div",{className:"px-4 pb-3 text-center",children:e.jsxs("span",{className:"text-xs text-gray-400",children:["Cached forecast • Updated ",new Date(r.generated_at).toLocaleTimeString()]})})]})};function Z(){var d,g,p,i,b,o,u;const{user:r}=T(),{data:s,isLoading:h}=F({queryKey:["dashboard"],queryFn:()=>C.get().then(a=>a.data.data),refetchInterval:3e4});return h?e.jsx(D,{}):e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-6",children:(r==null?void 0:r.role)==="super_admin"?"Platform Dashboard":"Dashboard"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:(r==null?void 0:r.role)==="super_admin"?e.jsxs(e.Fragment,{children:[e.jsx(c,{label:"Total Tenants",value:((d=s==null?void 0:s.tenants)==null?void 0:d.total)||0,color:"blue"}),e.jsx(c,{label:"Active Tenants",value:((g=s==null?void 0:s.tenants)==null?void 0:g.active)||0,color:"green"}),e.jsx(c,{label:"Total Users",value:(s==null?void 0:s.users)||0,color:"purple"}),e.jsx(c,{label:"Revenue Today",value:`৳${(s==null?void 0:s.revenue_today)||0}`,color:"yellow"})]}):e.jsxs(e.Fragment,{children:[e.jsx(c,{label:"Orders Today",value:((p=s==null?void 0:s.orders)==null?void 0:p.today)||0,color:"blue"}),e.jsx(c,{label:"Revenue Today",value:`৳${((i=s==null?void 0:s.revenue)==null?void 0:i.today)||0}`,color:"green"}),e.jsx(c,{label:"Pending",value:((b=s==null?void 0:s.orders)==null?void 0:b.pending)||0,color:"yellow"}),e.jsx(c,{label:"Revenue Month",value:`৳${((o=s==null?void 0:s.revenue)==null?void 0:o.this_month)||0}`,color:"purple"})]})}),(s==null?void 0:s.recent_orders)&&e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Recent Orders"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-500 border-b",children:[e.jsx("th",{className:"pb-3 pr-4",children:"Order #"}),e.jsx("th",{className:"pb-3 pr-4",children:"Type"}),e.jsx("th",{className:"pb-3 pr-4",children:"Table"}),e.jsx("th",{className:"pb-3 pr-4",children:"Total"}),e.jsx("th",{className:"pb-3",children:"Status"})]})}),e.jsx("tbody",{children:s.recent_orders.map(a=>{var n;return e.jsxs("tr",{className:"border-b last:border-0",children:[e.jsx("td",{className:"py-3 pr-4 font-medium",children:a.order_number}),e.jsx("td",{className:"py-3 pr-4 capitalize",children:a.type}),e.jsx("td",{className:"py-3 pr-4",children:((n=a.table)==null?void 0:n.table_number)||"-"}),e.jsxs("td",{className:"py-3 pr-4",children:["৳",a.grand_total]}),e.jsx("td",{className:"py-3",children:e.jsx($,{status:a.status})})]},a.id)})})]})})]}),((u=s==null?void 0:s.top_items)==null?void 0:u.length)>0&&e.jsxs("div",{className:"card mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Top Selling Items (This Month)"}),e.jsx("div",{className:"space-y-3",children:s.top_items.map((a,n)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"w-6 h-6 bg-blue-100 text-blue-700 rounded-full flex items-center justify-center text-xs font-bold mr-3",children:n+1}),e.jsx("span",{className:"font-medium",children:a.name})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:[a.total_qty," sold"]}),e.jsxs("span",{className:"ml-3 font-medium",children:["৳",a.total_revenue]})]})]},n))})]}),(r==null?void 0:r.role)==="restaurant_admin"&&e.jsx("div",{className:"mt-6",children:e.jsx(G,{})})]})}function c({label:r,value:s,color:h}){const d={blue:"bg-blue-50 text-blue-700 border-blue-200",green:"bg-green-50 text-green-700 border-green-200",yellow:"bg-yellow-50 text-yellow-700 border-yellow-200",purple:"bg-purple-50 text-purple-700 border-purple-200",red:"bg-red-50 text-red-700 border-red-200"};return e.jsxs("div",{className:`rounded-xl border p-5 ${d[h]}`,children:[e.jsx("p",{className:"text-sm opacity-80",children:r}),e.jsx("p",{className:"text-2xl font-bold mt-1",children:s})]})}export{Z as default};
