import{r as d,j as e,z as o,m as F,n as O,L as Q,o as C,p as U}from"./index-BzAOpcNr.js";import{u as L}from"./useQuery-CZF3df-b.js";import{u as _}from"./useMutation-DsUlt__W.js";import{M as $}from"./Modal-_HOdyNdP.js";import{L as V}from"./loader-circle-78KSwZRH.js";import{c as B,S as A}from"./sparkles-CkzBXKoQ.js";import{C as K,R as H}from"./refresh-cw-CuYNTEoE.js";import{y as D}from"./index-CSl-U68a.js";import"./iconBase-bw2gwbay.js";/**
 * @license lucide-react v0.575.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],T=B("check",J),W=({itemName:n,categoryName:j=null,price:N=null,currentDescription:s="",onDescriptionGenerated:y,className:w=""})=>{const[f,i]=d.useState(!1),[u,b]=d.useState(!1),[p,h]=d.useState([]),[v,x]=d.useState(!1),c=async(r={})=>{if(!(n!=null&&n.trim())){o.error("Please enter an item name first");return}i(!0),b(!1);try{const l=await F.generate(n,j,N,r);l.data.success?(y(l.data.description),o.success("Description generated!")):o.error(l.data.error||"Failed to generate")}catch(l){o.error("Failed to generate description"),console.error(l)}finally{i(!1)}},k=async()=>{if(!(s!=null&&s.trim())){o.error("No description to improve");return}i(!0);try{const r=await F.improve(n,s,j);r.data.success?(y(r.data.description),o.success("Description improved!")):o.error(r.data.error||"Failed to improve")}catch(r){o.error("Failed to improve description"),console.error(r)}finally{i(!1)}},m=async()=>{var r;if(!(n!=null&&n.trim())){o.error("Please enter an item name first");return}i(!0);try{const l=await F.alternatives(n,j,N,3);l.data.success&&((r=l.data.descriptions)==null?void 0:r.length)>0?(h(l.data.descriptions),x(!0)):o.error("No alternatives generated")}catch(l){o.error("Failed to get alternatives"),console.error(l)}finally{i(!1)}},S=r=>{y(r),x(!1),h([]),o.success("Description applied!")};return e.jsxs("div",{className:`relative ${w}`,children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("button",{type:"button",onClick:()=>c(),disabled:f||!(n!=null&&n.trim()),className:"inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-white bg-gradient-to-r from-purple-500 to-indigo-500 rounded-lg hover:from-purple-600 hover:to-indigo-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-sm",children:[f?e.jsx(V,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(A,{className:"w-3.5 h-3.5"}),f?"Generating...":"AI Generate"]}),e.jsx("button",{type:"button",onClick:()=>b(!u),disabled:f,className:"p-1.5 text-white bg-gradient-to-r from-purple-500 to-indigo-500 rounded-lg hover:from-purple-600 hover:to-indigo-600 disabled:opacity-50 transition-all",children:e.jsx(K,{className:`w-3.5 h-3.5 transition-transform ${u?"rotate-180":""}`})})]}),u&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>b(!1)}),e.jsx("div",{className:"absolute right-0 top-full mt-1 w-48 bg-white rounded-xl shadow-xl border border-gray-100 z-50 overflow-hidden",children:e.jsxs("div",{className:"p-1",children:[e.jsx("button",{type:"button",onClick:()=>c({style:"appetizing"}),className:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 rounded-lg transition-colors",children:"ðŸ½ï¸ Appetizing style"}),e.jsx("button",{type:"button",onClick:()=>c({style:"formal"}),className:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 rounded-lg transition-colors",children:"ðŸŽ© Formal style"}),e.jsx("button",{type:"button",onClick:()=>c({style:"casual"}),className:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 rounded-lg transition-colors",children:"ðŸ˜Š Casual style"}),e.jsx("button",{type:"button",onClick:()=>c({style:"playful"}),className:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 rounded-lg transition-colors",children:"ðŸŽ‰ Playful style"}),e.jsx("hr",{className:"my-1 border-gray-100"}),e.jsx("button",{type:"button",onClick:()=>c({length:"short"}),className:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 rounded-lg transition-colors",children:"ðŸ“ Short (8-12 words)"}),e.jsx("button",{type:"button",onClick:()=>c({length:"long"}),className:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 rounded-lg transition-colors",children:"ðŸ“„ Long (25-35 words)"}),e.jsx("hr",{className:"my-1 border-gray-100"}),e.jsxs("button",{type:"button",onClick:m,className:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(H,{className:"w-3.5 h-3.5"}),"Get 3 alternatives"]}),s&&e.jsxs("button",{type:"button",onClick:k,className:"w-full text-left px-3 py-2 text-sm text-purple-600 hover:bg-purple-50 rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(A,{className:"w-3.5 h-3.5"}),"Improve current"]})]})})]}),v&&p.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/20 z-50",onClick:()=>x(!1)}),e.jsxs("div",{className:"absolute right-0 top-full mt-1 w-80 bg-white rounded-xl shadow-2xl border border-gray-200 z-50 overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b border-gray-100",children:e.jsxs("h4",{className:"font-medium text-gray-800 text-sm flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4 text-purple-500"}),"Choose a description"]})}),e.jsx("div",{className:"p-2 space-y-2 max-h-64 overflow-y-auto",children:p.map((r,l)=>e.jsxs("button",{type:"button",onClick:()=>S(r),className:"w-full text-left p-3 bg-gray-50 hover:bg-purple-50 rounded-lg transition-colors group",children:[e.jsx("p",{className:"text-sm text-gray-700 leading-relaxed",children:r}),e.jsxs("span",{className:"text-xs text-purple-500 opacity-0 group-hover:opacity-100 transition-opacity mt-1 inline-flex items-center gap-1",children:[e.jsx(T,{className:"w-3 h-3"}),"Click to apply"]})]},l))}),e.jsx("div",{className:"p-2 border-t border-gray-100",children:e.jsx("button",{type:"button",onClick:()=>x(!1),className:"w-full text-center text-xs text-gray-500 hover:text-gray-700 py-1",children:"Cancel"})})]})]})]})};function ne(){var M,q,z,E;const n=O(),[j,N]=d.useState(!1),[s,y]=d.useState(null),[w,f]=d.useState(""),[i,u]=d.useState(null),[b,p]=d.useState(null),[h,v]=d.useState(""),x=d.useRef(null),{data:c,isLoading:k}=L({queryKey:["menu-items",w],queryFn:()=>C.list({search:w,per_page:100}).then(t=>t.data.data)}),{data:m}=L({queryKey:["categories"],queryFn:()=>U.list().then(t=>t.data.data)}),S=_({mutationFn:t=>C.toggle(t),onSuccess:()=>{n.invalidateQueries(["menu-items"]),o.success("Availability toggled")}}),r=_({mutationFn:t=>C.delete(t),onSuccess:()=>{n.invalidateQueries(["menu-items"]),o.success("Item deleted")}}),l=_({mutationFn:t=>s?C.update(s.id,t):C.create(t),onSuccess:()=>{n.invalidateQueries(["menu-items"]),I(),o.success(s?"Item updated":"Item created")},onError:t=>{var a,g;return o.error(((g=(a=t.response)==null?void 0:a.data)==null?void 0:g.message)||"Error")}}),I=()=>{N(!1),y(null),u(null),p(null),v("")},P=(t=null)=>{y(t),u((t==null?void 0:t.image_url)||null),p(null),v((t==null?void 0:t.description)||""),N(!0)},G=t=>{const a=t.target.files[0];a&&(p(a),u(URL.createObjectURL(a)))},R=t=>{t.preventDefault();const a=new FormData,g=Object.fromEntries(new FormData(t.target));a.append("name",g.name),a.append("price",g.price),g.category_id&&a.append("category_id",g.category_id),h&&a.append("description",h),a.append("is_active",t.target.is_active.checked?"1":"0"),b&&a.append("image",b),l.mutate(a)};return k?e.jsx(Q,{}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-800",children:"Menu Items"}),e.jsx("button",{onClick:()=>P(),className:"btn-primary text-sm sm:text-base",children:"+ Add Item"})]}),e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",className:"input max-w-xs",placeholder:"Search items...",value:w,onChange:t=>f(t.target.value)})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:c==null?void 0:c.map(t=>{var a;return e.jsxs("div",{className:`card ${t.is_active?"":"opacity-60"}`,children:[t.image_url?e.jsx("div",{className:"w-full h-40 rounded-lg overflow-hidden mb-3 bg-gray-100",children:e.jsx("img",{src:t.image_url,alt:t.name,className:"w-full h-full object-cover"})}):e.jsx("div",{className:"w-full h-40 rounded-lg mb-3 bg-gray-50 flex items-center justify-center",children:e.jsx(D,{className:"w-10 h-10 text-gray-300"})}),e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:t.name}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:((a=t.category)==null?void 0:a.name)||"Uncategorized"}),e.jsxs("p",{className:"text-lg font-bold text-blue-600 mt-2",children:["à§³",t.price]})]}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${t.is_active?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:t.is_active?"Active":"Inactive"})]}),t.description&&e.jsx("p",{className:"text-sm text-gray-400 mt-2 line-clamp-2",children:t.description}),e.jsxs("div",{className:"flex gap-2 mt-4 pt-4 border-t",children:[e.jsx("button",{onClick:()=>S.mutate(t.id),className:"text-sm text-blue-600 hover:text-blue-800",children:t.is_active?"Disable":"Enable"}),e.jsx("button",{onClick:()=>P(t),className:"text-sm text-gray-600 hover:text-gray-800",children:"Edit"}),e.jsx("button",{onClick:()=>{confirm("Delete this item?")&&r.mutate(t.id)},className:"text-sm text-red-600 hover:text-red-800",children:"Delete"})]})]},t.id)})}),e.jsx($,{isOpen:j,onClose:I,title:s?"Edit Item":"Add Item",children:e.jsxs("form",{onSubmit:R,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Image"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{onClick:()=>{var t;return(t=x.current)==null?void 0:t.click()},className:"w-24 h-24 rounded-xl border-2 border-dashed border-gray-300 flex items-center justify-center overflow-hidden bg-gray-50 cursor-pointer hover:border-blue-400 transition",children:i?e.jsx("img",{src:i,alt:"Preview",className:"w-full h-full object-cover"}):e.jsx(D,{className:"w-8 h-8 text-gray-400"})}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("button",{type:"button",onClick:()=>{var t;return(t=x.current)==null?void 0:t.click()},className:"text-sm text-blue-600 hover:text-blue-800",children:i?"Change Image":"Upload Image"}),i&&e.jsx("button",{type:"button",onClick:()=>{u(null),p(null)},className:"text-sm text-red-600 hover:text-red-800",children:"Remove"}),e.jsx("p",{className:"text-xs text-gray-400",children:"JPG, PNG. Max 2MB"})]})]}),e.jsx("input",{ref:x,type:"file",accept:"image/*",className:"hidden",onChange:G})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Name"}),e.jsx("input",{name:"name",className:"input",defaultValue:s==null?void 0:s.name,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Category"}),e.jsxs("select",{name:"category_id",className:"input",defaultValue:(s==null?void 0:s.category_id)||"",children:[e.jsx("option",{value:"",children:"Uncategorized"}),m==null?void 0:m.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Price (à§³)"}),e.jsx("input",{name:"price",type:"number",step:"0.01",className:"input",defaultValue:s==null?void 0:s.price,required:!0})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("label",{className:"label mb-0",children:"Description"}),e.jsx(W,{itemName:((M=document.querySelector('input[name="name"]'))==null?void 0:M.value)||(s==null?void 0:s.name)||"",categoryName:((q=m==null?void 0:m.find(t=>{var a;return t.id==((a=document.querySelector('select[name="category_id"]'))==null?void 0:a.value)}))==null?void 0:q.name)||((z=s==null?void 0:s.category)==null?void 0:z.name),price:parseFloat((E=document.querySelector('input[name="price"]'))==null?void 0:E.value)||(s==null?void 0:s.price),currentDescription:h,onDescriptionGenerated:t=>v(t)})]}),e.jsx("textarea",{name:"description",className:"input",rows:2,value:h,onChange:t=>v(t.target.value),placeholder:"Enter description or click AI Generate..."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{name:"is_active",type:"checkbox",defaultChecked:(s==null?void 0:s.is_active)??!0,className:"rounded"}),e.jsx("label",{className:"text-sm",children:"Available"})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"submit",className:"btn-primary",disabled:l.isPending,children:l.isPending?"Saving...":"Save"}),e.jsx("button",{type:"button",onClick:I,className:"btn-secondary",children:"Cancel"})]})]})})]})}export{ne as default};
