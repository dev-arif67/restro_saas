import{n as H,r as h,j as e,L as R,z as D,I as g}from"./index-BzAOpcNr.js";import{u as F}from"./useQuery-CZF3df-b.js";import{u as M}from"./useMutation-DsUlt__W.js";import{Q as A,a1 as I,k as N,a2 as O,_ as B,Z as E,a3 as q,U as L,a4 as Q,e as z}from"./index-CSl-U68a.js";import"./iconBase-bw2gwbay.js";function Z(){var _,C,P,k;const b=H(),[x,u]=h.useState({status:"",tenant_id:"",from_date:"",to_date:""}),[i,o]=h.useState(1),[t,p]=h.useState(null),[f,j]=h.useState(!1),[m,r]=h.useState({amount:"",method:"bank_transfer",note:""}),{data:d,isLoading:T,refetch:U}=F({queryKey:["admin-settlements",i,x],queryFn:()=>g.settlements.list({page:i,per_page:20,...x}).then(s=>s.data)}),{data:l}=F({queryKey:["admin-financial-stats"],queryFn:()=>g.settlements.stats().then(s=>s.data.data)}),y=M({mutationFn:({settlementId:s,data:a})=>g.settlements.recordPayment(s,a),onSuccess:()=>{b.invalidateQueries(["admin-settlements"]),b.invalidateQueries(["admin-financial-stats"]),D.success("Payment recorded"),j(!1),r({amount:"",method:"bank_transfer",note:""})},onError:s=>{var a,S;return D.error(((S=(a=s.response)==null?void 0:a.data)==null?void 0:S.message)||"Failed to record payment")}}),v=s=>{const a={pending:"bg-yellow-100 text-yellow-700",partial:"bg-blue-100 text-blue-700",paid:"bg-green-100 text-green-700",overdue:"bg-red-100 text-red-700"};return e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${a[s]||"bg-gray-100 text-gray-700"}`,children:(s==null?void 0:s.charAt(0).toUpperCase())+(s==null?void 0:s.slice(1))})},n=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"BDT",minimumFractionDigits:0}).format(s||0);if(T)return e.jsx(R,{});const w=(d==null?void 0:d.data)||[],c=d==null?void 0:d.meta;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Financial Management"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Track settlements, commissions, and payments"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white rounded-xl p-5 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total Revenue"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n(l==null?void 0:l.total_revenue)})]}),e.jsx("div",{className:"w-10 h-10 bg-green-50 rounded-full flex items-center justify-center",children:e.jsx(A,{className:"w-5 h-5 text-green-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl p-5 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Commission Earned"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:n(l==null?void 0:l.total_commission)})]}),e.jsx("div",{className:"w-10 h-10 bg-blue-50 rounded-full flex items-center justify-center",children:e.jsx(I,{className:"w-5 h-5 text-blue-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl p-5 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Pending Payouts"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:n(l==null?void 0:l.pending_payouts)})]}),e.jsx("div",{className:"w-10 h-10 bg-yellow-50 rounded-full flex items-center justify-center",children:e.jsx(N,{className:"w-5 h-5 text-yellow-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl p-5 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Completed Payouts"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:n(l==null?void 0:l.completed_payouts)})]}),e.jsx("div",{className:"w-10 h-10 bg-green-50 rounded-full flex items-center justify-center",children:e.jsx(O,{className:"w-5 h-5 text-green-600"})})]})})]}),((_=l==null?void 0:l.commission_by_tenant)==null?void 0:_.length)>0&&e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Commission by Tenant (This Month)"}),e.jsx("div",{className:"space-y-3",children:l.commission_by_tenant.slice(0,5).map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-sm font-medium",children:a+1}),e.jsx("span",{className:"text-gray-900",children:s.name})]}),e.jsx("span",{className:"font-semibold text-gray-700",children:n(s.commission)})]},a))})]}),e.jsx("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsx(B,{className:"w-5 h-5 text-gray-400"}),e.jsxs("select",{value:x.status,onChange:s=>{u(a=>({...a,status:s.target.value})),o(1)},className:"input w-36",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"partial",children:"Partial"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"overdue",children:"Overdue"})]}),e.jsx("input",{type:"date",value:x.from_date,onChange:s=>{u(a=>({...a,from_date:s.target.value})),o(1)},className:"input",placeholder:"From"}),e.jsx("input",{type:"date",value:x.to_date,onChange:s=>{u(a=>({...a,to_date:s.target.value})),o(1)},className:"input",placeholder:"To"}),e.jsx("button",{onClick:()=>u({status:"",tenant_id:"",from_date:"",to_date:""}),className:"text-sm text-gray-500 hover:text-gray-700",children:"Clear"})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Settlement Records"}),e.jsxs("button",{className:"btn-secondary text-sm flex items-center gap-2",children:[e.jsx(E,{className:"w-4 h-4"}),"Export"]})]}),e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500",children:"ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500",children:"Tenant"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500",children:"Period"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"Gross Revenue"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"Commission"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"Net Payout"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500",children:"Paid"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500",children:"Status"}),e.jsx("th",{className:"px-4 py-3"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:w.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:"9",className:"px-4 py-12 text-center text-gray-500",children:[e.jsx(q,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),"No settlements found"]})}):w.map(s=>{var a;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-4 py-3 text-sm font-mono text-gray-500",children:["#",s.id]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("p",{className:"font-medium text-gray-900",children:((a=s.tenant)==null?void 0:a.name)||"-"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:s.period_start&&s.period_end?`${new Date(s.period_start).toLocaleDateString()} - ${new Date(s.period_end).toLocaleDateString()}`:s.settlement_date}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-gray-900",children:n(s.gross_revenue)}),e.jsxs("td",{className:"px-4 py-3 text-sm text-right text-blue-600",children:[n(s.commission_amount),s.commission_rate&&e.jsxs("span",{className:"text-xs text-gray-400 ml-1",children:["(",s.commission_rate,"%)"]})]}),e.jsx("td",{className:"px-4 py-3 text-sm text-right font-semibold text-gray-900",children:n(s.net_payout)}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-green-600",children:n(s.amount_paid||0)}),e.jsx("td",{className:"px-4 py-3 text-center",children:v(s.status)}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx("button",{onClick:()=>p(s),className:"text-gray-400 hover:text-gray-600",title:"View Details",children:e.jsx(L,{className:"w-4 h-4"})}),s.status!=="paid"&&e.jsx("button",{onClick:()=>{p(s),r({amount:(s.net_payout-(s.amount_paid||0)).toFixed(2),method:"bank_transfer",note:""}),j(!0)},className:"text-gray-400 hover:text-green-600",title:"Record Payment",children:e.jsx(N,{className:"w-4 h-4"})}),e.jsx("button",{className:"text-gray-400 hover:text-gray-600",title:"Download Invoice",children:e.jsx(Q,{className:"w-4 h-4"})})]})})]},s.id)})})]}),c&&c.last_page>1&&e.jsxs("div",{className:"px-4 py-3 bg-gray-50 border-t flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["Showing ",c.from," to ",c.to," of ",c.total]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>o(i-1),disabled:i===1,className:"btn-secondary py-1 px-3 text-sm disabled:opacity-50",children:"Previous"}),e.jsx("button",{onClick:()=>o(i+1),disabled:i>=c.last_page,className:"btn-secondary py-1 px-3 text-sm disabled:opacity-50",children:"Next"})]})]})]}),t&&!f&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Settlement #",t.id]}),e.jsx("button",{onClick:()=>p(null),className:"text-gray-400 hover:text-gray-600",children:e.jsx(z,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Tenant"}),e.jsx("p",{className:"font-semibold text-gray-900",children:(C=t.tenant)==null?void 0:C.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Status"}),v(t.status)]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Period"}),e.jsxs("p",{className:"text-gray-900",children:[t.period_start," - ",t.period_end]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Settlement Date"}),e.jsx("p",{className:"text-gray-900",children:t.settlement_date})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Gross Revenue"}),e.jsx("span",{className:"text-gray-900",children:n(t.gross_revenue)})]}),e.jsxs("div",{className:"flex justify-between text-blue-600",children:[e.jsxs("span",{children:["Commission (",t.commission_rate,"%)"]}),e.jsxs("span",{children:["- ",n(t.commission_amount)]})]}),t.vat_amount>0&&e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"VAT"}),e.jsxs("span",{children:["- ",n(t.vat_amount)]})]}),e.jsxs("div",{className:"border-t pt-2 flex justify-between font-semibold",children:[e.jsx("span",{className:"text-gray-900",children:"Net Payout"}),e.jsx("span",{className:"text-gray-900",children:n(t.net_payout)})]}),t.amount_paid>0&&e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsx("span",{children:"Amount Paid"}),e.jsx("span",{children:n(t.amount_paid)})]}),t.status!=="paid"&&e.jsxs("div",{className:"flex justify-between text-yellow-600",children:[e.jsx("span",{children:"Balance Due"}),e.jsx("span",{children:n(t.net_payout-(t.amount_paid||0))})]})]}),((P=t.payments)==null?void 0:P.length)>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Payment History"}),e.jsx("div",{className:"space-y-2",children:t.payments.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-3 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-900",children:n(s.amount)}),e.jsxs("p",{className:"text-xs text-gray-500",children:[s.method," • ",s.date]})]}),e.jsx(O,{className:"w-5 h-5 text-green-500"})]},a))})]})]}),e.jsxs("div",{className:"p-6 border-t flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>p(null),className:"btn-secondary",children:"Close"}),t.status!=="paid"&&e.jsxs("button",{onClick:()=>{r({amount:(t.net_payout-(t.amount_paid||0)).toFixed(2),method:"bank_transfer",note:""}),j(!0)},className:"btn-primary flex items-center gap-2",children:[e.jsx(N,{className:"w-4 h-4"}),"Record Payment"]})]})]})}),f&&t&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-md",children:[e.jsxs("div",{className:"p-6 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Record Payment"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Settlement #",t.id," • ",(k=t.tenant)==null?void 0:k.name]})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("div",{className:"bg-gray-50 rounded-lg p-3",children:e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Balance Due:"}),e.jsx("span",{className:"font-semibold text-gray-900",children:n(t.net_payout-(t.amount_paid||0))})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount"}),e.jsx("input",{type:"number",value:m.amount,onChange:s=>r(a=>({...a,amount:s.target.value})),className:"input w-full",step:"0.01"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Method"}),e.jsxs("select",{value:m.method,onChange:s=>r(a=>({...a,method:s.target.value})),className:"input w-full",children:[e.jsx("option",{value:"bank_transfer",children:"Bank Transfer"}),e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"mobile_banking",children:"Mobile Banking"}),e.jsx("option",{value:"check",children:"Check"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Note (Optional)"}),e.jsx("textarea",{value:m.note,onChange:s=>r(a=>({...a,note:s.target.value})),className:"input w-full",rows:3,placeholder:"Transaction ID, reference number, etc."})]})]}),e.jsxs("div",{className:"p-6 border-t flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>{j(!1),r({amount:"",method:"bank_transfer",note:""})},className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:()=>y.mutate({settlementId:t.id,data:m}),disabled:!m.amount||y.isPending,className:"btn-primary",children:y.isPending?"Recording...":"Record Payment"})]})]})})]})}export{Z as default};
