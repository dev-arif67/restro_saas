import{d as H,b as P,i as A,u as N,r as f,j as e,L as U,f as q,z as x,C as u}from"./index-CGzGCCal.js";import{u as I}from"./useQuery-B-VUE0ak.js";import{u as b}from"./useMutation-BwYhN-QW.js";import{M as z}from"./Modal-B5_Zfgyv.js";import{S as w}from"./StatusBadge-CVOwn4cx.js";import{L as B,m as Q,S as $,r as R,Q as J,w as K,k as V}from"./index-BX6eEVf5.js";import"./iconBase-Bj3tzzhS.js";function ae(){var v;const{id:i}=H(),y=P(),S=A(),{setToken:_,setUser:C}=N(),[D,m]=f.useState(!1),[d,g]=f.useState({subject:"",message:""}),{data:E,isLoading:M,error:k}=I({queryKey:["admin-tenant-stats",i],queryFn:()=>u.tenants.stats(i).then(s=>s.data.data)}),p=b({mutationFn:()=>u.tenants.impersonate(i),onSuccess:s=>{const{token:r,user:l,tenant:h}=s.data.data,T=N.getState().token,F=N.getState().user;localStorage.setItem("admin_original_token",T),localStorage.setItem("admin_original_user",JSON.stringify(F)),_(r),C(l),x.success(`Now impersonating ${h.name}`),y("/dashboard")},onError:s=>{var r,l;return x.error(((l=(r=s.response)==null?void 0:r.data)==null?void 0:l.message)||"Failed to impersonate")}}),j=b({mutationFn:s=>u.tenants.sendEmail(i,s),onSuccess:()=>{m(!1),g({subject:"",message:""}),x.success("Email sent successfully")},onError:s=>{var r,l;return x.error(((l=(r=s.response)==null?void 0:r.data)==null?void 0:l.message)||"Failed to send email")}}),L=b({mutationFn:({is_active:s})=>u.tenants.update(i,{is_active:s}),onSuccess:()=>{S.invalidateQueries(["admin-tenant-stats",i]),x.success("Tenant status updated")}});if(M)return e.jsx(U,{});if(k)return e.jsx("div",{className:"text-red-500",children:"Error loading tenant details"});const{tenant:a,stats:t,subscriptions:c,revenue_trend:o}=E||{},n=s=>new Intl.NumberFormat("en-BD",{style:"currency",currency:"BDT",minimumFractionDigits:0}).format(s||0),O=s=>{s.preventDefault(),j.mutate(d)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>y("/dashboard/admin/tenants"),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(B,{className:"w-5 h-5 text-gray-600"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:a==null?void 0:a.name}),e.jsx(w,{status:a!=null&&a.is_active?"active":"inactive"})]}),e.jsxs("p",{className:"text-gray-500 text-sm",children:[a==null?void 0:a.slug," • ",a==null?void 0:a.email]})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>m(!0),className:"btn-secondary flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),"Send Email"]}),e.jsxs("button",{onClick:()=>p.mutate(),disabled:p.isPending,className:"btn-secondary flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4"}),p.isPending?"Loading...":"Impersonate"]}),e.jsx("button",{onClick:()=>L.mutate({is_active:!(a!=null&&a.is_active)}),className:`btn ${a!=null&&a.is_active?"bg-red-50 text-red-600 hover:bg-red-100":"bg-green-50 text-green-600 hover:bg-green-100"}`,children:a!=null&&a.is_active?"Deactivate":"Activate"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white rounded-xl p-5 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-blue-50 rounded-xl",children:e.jsx(R,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total Orders"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:(t==null?void 0:t.total_orders)||0}),e.jsxs("p",{className:"text-xs text-gray-400",children:[(t==null?void 0:t.orders_this_month)||0," this month"]})]})]})}),e.jsx("div",{className:"bg-white rounded-xl p-5 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-green-50 rounded-xl",children:e.jsx(J,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total Revenue"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n(t==null?void 0:t.total_revenue)}),e.jsxs("p",{className:"text-xs text-gray-400",children:[n(t==null?void 0:t.revenue_this_month)," this month"]})]})]})}),e.jsx("div",{className:"bg-white rounded-xl p-5 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-purple-50 rounded-xl",children:e.jsx(K,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Active Users"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:(t==null?void 0:t.active_users)||0}),e.jsxs("p",{className:"text-xs text-gray-400",children:[(t==null?void 0:t.total_users)||0," total"]})]})]})}),e.jsx("div",{className:"bg-white rounded-xl p-5 shadow-sm border border-gray-100",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-yellow-50 rounded-xl",children:e.jsx(V,{className:"w-6 h-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Balance Due"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:n(t==null?void 0:t.balance_due)}),e.jsxs("p",{className:"text-xs text-gray-400",children:[n(t==null?void 0:t.total_paid)," paid"]})]})]})})]}),(o==null?void 0:o.length)>0&&e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Revenue Trend (Last 6 Months)"}),e.jsx("div",{className:"space-y-3",children:o.map(s=>e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"w-16 text-sm text-gray-500",children:s.month}),e.jsx("div",{className:"flex-1 h-4 bg-gray-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500 rounded-full",style:{width:`${Math.min(s.revenue/Math.max(...o.map(r=>r.revenue),1)*100,100)}%`}})}),e.jsx("span",{className:"w-28 text-sm text-gray-700 text-right",children:n(s.revenue)}),e.jsxs("span",{className:"w-16 text-xs text-gray-400",children:[s.orders," orders"]})]},s.month))})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Subscription History"}),e.jsx(q,{to:`/dashboard/admin/subscriptions?tenant_id=${i}`,className:"text-sm text-blue-600 hover:underline",children:"View all →"})]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left border-b",children:[e.jsx("th",{className:"pb-3",children:"Plan"}),e.jsx("th",{className:"pb-3",children:"Amount"}),e.jsx("th",{className:"pb-3",children:"Start Date"}),e.jsx("th",{className:"pb-3",children:"Expiry Date"}),e.jsx("th",{className:"pb-3",children:"Status"})]})}),e.jsx("tbody",{children:c==null?void 0:c.map(s=>e.jsxs("tr",{className:"border-b last:border-0",children:[e.jsx("td",{className:"py-3 capitalize",children:s.plan_type}),e.jsx("td",{className:"py-3",children:n(s.amount)}),e.jsx("td",{className:"py-3",children:new Date(s.starts_at).toLocaleDateString()}),e.jsx("td",{className:"py-3",children:new Date(s.expires_at).toLocaleDateString()}),e.jsx("td",{className:"py-3",children:e.jsx(w,{status:s.status})})]},s.id))})]}),(!c||c.length===0)&&e.jsx("p",{className:"text-gray-400 text-center py-4",children:"No subscriptions found"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Users"}),e.jsx("div",{className:"space-y-3",children:(v=a==null?void 0:a.users)==null?void 0:v.map(s=>{var r,l,h;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-medium",children:(l=(r=s.name)==null?void 0:r[0])==null?void 0:l.toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-xs px-2 py-1 bg-gray-200 text-gray-700 rounded-full capitalize",children:(h=s.role)==null?void 0:h.replace("_"," ")}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:s.status})]})]},s.id)})})]}),e.jsx(z,{isOpen:D,onClose:()=>m(!1),title:"Send Email to Tenant",children:e.jsxs("form",{onSubmit:O,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Subject"}),e.jsx("input",{type:"text",className:"input",value:d.subject,onChange:s=>g({...d,subject:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Message"}),e.jsx("textarea",{className:"input min-h-[150px]",value:d.message,onChange:s=>g({...d,message:s.target.value}),required:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",className:"btn-primary",disabled:j.isPending,children:j.isPending?"Sending...":"Send Email"}),e.jsx("button",{type:"button",onClick:()=>m(!1),className:"btn-secondary",children:"Cancel"})]})]})})]})}export{ae as default};
