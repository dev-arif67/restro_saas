import{c as f,r as h,j as e,L as y,o as u}from"./index-VcNFqetI.js";import{u as N}from"./useQuery-Rt3S72ZS.js";import{S as v}from"./StatusBadge-DtDva7gu.js";import{P as w}from"./POSInvoice-0SuoJ50S.js";import{h as _,l as P,v as S}from"./index-DXY5cShP.js";const p=["placed","confirmed","preparing","ready","served","completed"];function k(){var m;const{orderNumber:n}=f(),[j,l]=h.useState(!1),[d,c]=h.useState(null),{data:s,isLoading:b}=N({queryKey:["track-order",n],queryFn:()=>u.track(n).then(t=>t.data.data),refetchInterval:5e3}),g=async()=>{try{const t=await u.invoice(n);c(t.data.data),l(!0)}catch{c({order:s,restaurant:null}),l(!0)}};if(b)return e.jsx(y,{fullScreen:!0});if(!s)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-800",children:"Order Not Found"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Check the order number and try again"})]})});const x=p.indexOf(s.status),r=s.payment_status==="paid";return e.jsxs("div",{className:"min-h-screen bg-gray-50 py-8 px-4",children:[e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:["Order #",s.order_number]}),e.jsxs("div",{className:"mt-2 flex items-center justify-center gap-2 flex-wrap",children:[e.jsx(v,{status:s.status}),e.jsx("span",{className:"text-sm text-gray-400 capitalize",children:s.type==="dine"?"Dine-in":"Takeaway"})]})]}),e.jsxs("div",{className:`rounded-2xl p-5 shadow-sm mb-6 ${r?"bg-green-50 border border-green-200":"bg-amber-50 border border-amber-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.payment_method==="cash"?e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(_,{className:"w-5 h-5 text-blue-600"})}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center",children:e.jsx(P,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:s.payment_method==="cash"?"Pay at Counter":"Online Payment"}),e.jsx("p",{className:`text-sm font-medium ${r?"text-green-600":"text-amber-600"}`,children:r?"Payment Received":"Payment Pending"})]})]}),e.jsxs("p",{className:"text-xl font-bold text-gray-900",children:["৳",s.grand_total]})]}),s.payment_method==="cash"&&!r&&e.jsxs("p",{className:"text-sm text-amber-700 mt-3 bg-amber-100 rounded-lg p-2 text-center",children:["Please pay ",e.jsxs("strong",{children:["৳",parseFloat(s.grand_total).toFixed(2)]})," at the counter"]}),s.transaction_id&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Transaction ID: ",s.transaction_id]})]}),e.jsxs("button",{onClick:g,className:"w-full mb-6 flex items-center justify-center gap-2 py-3 bg-white border border-gray-200 rounded-2xl text-gray-700 font-medium hover:bg-gray-50 shadow-sm transition",children:[e.jsx(S,{className:"w-5 h-5"}),"View & Download Invoice"]}),s.status!=="cancelled"&&e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm mb-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Order Progress"}),e.jsx("div",{className:"space-y-4",children:p.map((t,a)=>{const i=a<=x,o=a===x;return e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${i?"bg-green-500 text-white":"bg-gray-200 text-gray-400"} ${o?"ring-4 ring-green-200":""}`,children:i?"✓":a+1}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:`font-medium capitalize ${i?"text-green-700":"text-gray-400"}`,children:t})}),o&&e.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full animate-pulse",children:"Current"})]},t)})})]}),s.status==="cancelled"&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-2xl p-6 text-center mb-6",children:e.jsx("p",{className:"text-red-600 font-bold text-lg",children:"Order Cancelled"})}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm mb-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Items"}),e.jsx("div",{className:"space-y-3",children:(m=s.items)==null?void 0:m.map(t=>{var a;return e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-bold mr-2",children:[t.qty,"x"]}),e.jsx("span",{children:(a=t.menu_item)==null?void 0:a.name})]}),e.jsxs("span",{className:"font-medium",children:["৳",t.line_total]})]},t.id)})}),e.jsxs("div",{className:"border-t mt-4 pt-4 space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Subtotal"}),e.jsxs("span",{children:["৳",s.subtotal]})]}),parseFloat(s.discount)>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"Discount"}),e.jsxs("span",{children:["-৳",s.discount]})]}),parseFloat(s.tax)>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Tax"}),e.jsxs("span",{children:["৳",s.tax]})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold pt-2 border-t",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["৳",s.grand_total]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Details"}),e.jsxs("div",{className:"text-sm space-y-2 text-gray-600",children:[s.table&&e.jsxs("p",{children:["Table: ",s.table.table_number]}),s.customer_name&&e.jsxs("p",{children:["Name: ",s.customer_name]}),s.customer_phone&&e.jsxs("p",{children:["Phone: ",s.customer_phone]}),e.jsxs("p",{children:["Placed: ",new Date(s.created_at).toLocaleString()]}),s.paid_at&&e.jsxs("p",{children:["Paid: ",new Date(s.paid_at).toLocaleString()]})]})]})]}),j&&d&&e.jsx(w,{order:d.order,restaurant:d.restaurant,onClose:()=>l(!1)})]})}export{k as default};
